# ä»»åŠ¡ 5ï¼šè¿è¡Œæ—¶å¯è§†åŒ– - å¿«é€ŸéªŒè¯æŒ‡å—

## ğŸš€ å¿«é€ŸéªŒè¯æ­¥éª¤

### 1. è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

```bash
python3 test_budget_visualization.py
```

**é¢„æœŸç»“æœ**:
```
Results: 5/5 tests passed
âœ… All tests passed! Task 5 implementation is complete.
```

### 2. å¯åŠ¨ AgentOS WebUI

```bash
# å¯åŠ¨æœåŠ¡
python -m agentos.cli webui

# æˆ–ä½¿ç”¨ä½ çš„å¯åŠ¨å‘½ä»¤
agentos webui
```

### 3. éªŒè¯ Chat ç•Œé¢é¢„ç®—æŒ‡ç¤ºå™¨

#### 3.1 æ‰“å¼€ Chat ç•Œé¢
1. åœ¨æµè§ˆå™¨ä¸­è®¿é—® WebUIï¼ˆé€šå¸¸æ˜¯ http://localhost:8000ï¼‰
2. ç¡®ä¿åœ¨ Chat è§†å›¾
3. å¼€å§‹ä¸€ä¸ªæ–°å¯¹è¯æˆ–é€‰æ‹©ç°æœ‰å¯¹è¯

#### 3.2 å‘é€æ¶ˆæ¯
1. åœ¨è¾“å…¥æ¡†è¾“å…¥ä¸€æ¡æ¶ˆæ¯ï¼ˆä¾‹å¦‚ï¼š"Hello, can you help me?"ï¼‰
2. ç‚¹å‡» Send æŒ‰é’®

#### 3.3 æ£€æŸ¥é¢„ç®—æŒ‡ç¤ºå™¨
**åº”è¯¥çœ‹åˆ°**:
- é¡¶éƒ¨å·¥å…·æ å³ä¾§å‡ºç°é¢„ç®—æŒ‡ç¤ºå™¨
- æ˜¾ç¤ºæ ¼å¼ï¼š`ğŸ“Š Budget: X.Xk/Y.Yk (Z%)`
- çŠ¶æ€å¾½ç« ï¼šğŸŸ¢ Safe / ğŸŸ¡ Warning / ğŸ”´ Critical

**ç¤ºä¾‹**:
```
ğŸ“Š Budget: 3.2k/91.8k (3%)
[ğŸŸ¢ Safe]
```

#### 3.4 ç‚¹å‡»é¢„ç®—æŒ‡ç¤ºå™¨
1. ç‚¹å‡»é¢„ç®—æŒ‡ç¤ºå™¨
2. **åº”è¯¥å¼¹å‡ºè¯¦æƒ…æ¨¡æ€æ¡†**ï¼Œæ˜¾ç¤ºï¼š
   - Token Budget Breakdown æ ‡é¢˜
   - 4 ä¸ªç»„ä»¶çš„ä½¿ç”¨æƒ…å†µï¼ˆSystemã€Windowã€RAGã€Memoryï¼‰
   - è¿›åº¦æ¡å¯è§†åŒ–
   - æç¤ºä¿¡æ¯

### 4. éªŒè¯ Context View Budget æ ‡ç­¾é¡µ

#### 4.1 åˆ‡æ¢åˆ° Context View
1. ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ çš„ "Context" èœå•é¡¹

#### 4.2 é€‰æ‹© Session
1. åœ¨ "Session ID" è¾“å…¥æ¡†ä¸­è¾“å…¥å½“å‰ä¼šè¯ ID
   - æˆ–ç‚¹å‡» "Recent Sessions" é€‰æ‹©
2. ç‚¹å‡» "Load Context Status"

#### 4.3 åˆ‡æ¢åˆ° Budget æ ‡ç­¾
1. **åº”è¯¥çœ‹åˆ° 4 ä¸ªæ ‡ç­¾**: Status, Budget, Operations, Raw Data
2. ç‚¹å‡» "Budget" æ ‡ç­¾
3. **åº”è¯¥æ˜¾ç¤º**:
   - Configuration Sourceï¼ˆAuto-derived / Configuredï¼‰
   - Allocation Tableï¼ˆé¢„ç®—åˆ†é…è¡¨ï¼‰
   - Trimming Historyï¼ˆæˆªæ–­å†å²ï¼‰

#### 4.4 æ£€æŸ¥é¢„ç®—åˆ†é…è¡¨
**åº”è¯¥æ˜¾ç¤º 4 è¡Œæ•°æ®**:
| Component | Budget | Used | % Used |
|-----------|--------|------|--------|
| System    | 1,000  | 832  | 83.2%  |
| Window    | 4,000  | 2,124 | 53.1%  |
| RAG       | 2,000  | 456  | 22.8%  |
| Memory    | 1,000  | 121  | 12.1%  |

ï¼ˆå®é™…æ•°å€¼ä¼šæ ¹æ®å¯¹è¯å†…å®¹å˜åŒ–ï¼‰

### 5. éªŒè¯ä¸åŒçŠ¶æ€

#### 5.1 Safe çŠ¶æ€ (<60%)
**è§¦å‘æ–¹å¼**: å‘é€ 1-2 æ¡çŸ­æ¶ˆæ¯

**é¢„æœŸæ˜¾ç¤º**:
```
ğŸ“Š Budget: 5.4k/91.8k (6%)
[ğŸŸ¢ Safe]
```

#### 5.2 Warning çŠ¶æ€ (60-80%)
**è§¦å‘æ–¹å¼**:
- å‘é€è¾ƒé•¿çš„å¯¹è¯å†å²
- æˆ–å¯ç”¨ RAG å¹¶æŸ¥è¯¢å¤§é‡æ–‡æ¡£

**é¢„æœŸæ˜¾ç¤º**:
```
ğŸ“Š Budget: 65.3k/91.8k (71%)
[ğŸŸ¡ Warning] Context nearing limit. Consider /summary.
```

#### 5.3 Critical çŠ¶æ€ (>80%)
**è§¦å‘æ–¹å¼**:
- é•¿æ—¶é—´å¯¹è¯ï¼ˆ>20 æ¡æ¶ˆæ¯ï¼‰
- å¯ç”¨ RAG å’Œ Memory

**é¢„æœŸæ˜¾ç¤º**:
```
ğŸ“Š Budget: 82.1k/91.8k (89%)
[ğŸ”´ Critical] Context full! Oldest messages truncated.
```

### 6. éªŒè¯ WebSocket æ—¥å¿—

#### 6.1 æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
- Chrome/Edge: F12 > Console æ ‡ç­¾
- Firefox: F12 > æ§åˆ¶å°
- Safari: Cmd+Opt+C

#### 6.2 æ£€æŸ¥æ—¥å¿—
å‘é€æ¶ˆæ¯åï¼Œ**åº”è¯¥çœ‹åˆ°**:
```javascript
Budget update: {...}
Budget indicator updated: 6% used (safe)
```

### 7. éªŒè¯åç«¯æ—¥å¿—

#### 7.1 æŸ¥çœ‹ AgentOS æœåŠ¡æ—¥å¿—
```bash
# åœ¨è¿è¡Œ webui çš„ç»ˆç«¯çª—å£æŸ¥çœ‹
```

#### 7.2 æ£€æŸ¥æ—¥å¿—
**åº”è¯¥çœ‹åˆ°ç±»ä¼¼å†…å®¹**:
```
INFO - Building context for session <session_id> (reason: send)
INFO - Budget: 91800 tokens (source: auto-derived, model_window: 128000)
WARNING - Context over budget (92000 tokens), trimming
WARNING - Trimmed 2 messages from window (budget: 45900)
INFO - Sent budget update: 6.00% used
```

## âœ… éªŒæ”¶æ£€æŸ¥æ¸…å•

### å‰ç«¯
- [ ] Chat ç•Œé¢é¡¶éƒ¨æ˜¾ç¤ºé¢„ç®—æŒ‡ç¤ºå™¨
- [ ] é¢„ç®—æŒ‡ç¤ºå™¨å®æ—¶æ›´æ–°
- [ ] çŠ¶æ€é¢œè‰²æ­£ç¡®ï¼ˆç»¿/é»„/çº¢ï¼‰
- [ ] ç‚¹å‡»é¢„ç®—æŒ‡ç¤ºå™¨æ˜¾ç¤ºè¯¦æƒ…æ¨¡æ€æ¡†
- [ ] è¯¦æƒ…æ¨¡æ€æ¡†æ˜¾ç¤º 4 ä¸ªç»„ä»¶çš„ä½¿ç”¨æƒ…å†µ
- [ ] è¿›åº¦æ¡å¯è§†åŒ–æ­£ç¡®

### Context View
- [ ] Context View æœ‰ "Budget" æ ‡ç­¾é¡µ
- [ ] Budget æ ‡ç­¾é¡µæ˜¾ç¤ºé…ç½®æ¥æº
- [ ] é¢„ç®—åˆ†é…è¡¨æ˜¾ç¤ºæ­£ç¡®
- [ ] æˆªæ–­å†å²æ˜¾ç¤ºæ­£ç¡®ï¼ˆå¦‚æœ‰ï¼‰

### WebSocket
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º budget_update æ—¥å¿—
- [ ] åç«¯æ—¥å¿—æ˜¾ç¤ºé¢„ç®—ä¿¡æ¯
- [ ] åç«¯æ—¥å¿—æ˜¾ç¤ºæˆªæ–­ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰

### åŠŸèƒ½
- [ ] Safe çŠ¶æ€æ­£ç¡®è§¦å‘
- [ ] Warning çŠ¶æ€æ­£ç¡®è§¦å‘
- [ ] Critical çŠ¶æ€æ­£ç¡®è§¦å‘
- [ ] æç¤ºä¿¡æ¯æ¸…æ™°æ˜“æ‡‚

## ğŸ› å¸¸è§é—®é¢˜

### Q1: é¢„ç®—æŒ‡ç¤ºå™¨ä¸æ˜¾ç¤º
**å¯èƒ½åŸå› **:
- ä¸åœ¨ Chat è§†å›¾
- WebSocket æœªè¿æ¥
- è¿˜æœªå‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®ä¿åœ¨ Chat è§†å›¾
2. æ£€æŸ¥ WebSocket è¿æ¥çŠ¶æ€
3. å‘é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯

### Q2: é¢„ç®—ä¸€ç›´æ˜¾ç¤º "--"
**å¯èƒ½åŸå› **:
- WebSocket æ¶ˆæ¯æœªåˆ°è¾¾
- åç«¯æœªå‘é€ budget_update

**è§£å†³æ–¹æ¡ˆ**:
1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥ WebSocket æ¶ˆæ¯
2. æ£€æŸ¥åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
3. åˆ·æ–°é¡µé¢é‡è¯•

### Q3: Context View Budget æ ‡ç­¾é¡µç©ºç™½
**å¯èƒ½åŸå› **:
- Session ID æ— æ•ˆ
- ä¸Šä¸‹æ–‡å°šæœªæ„å»º

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤è¾“å…¥æ­£ç¡®çš„ Session ID
2. å…ˆåœ¨ Chat ç•Œé¢å‘é€æ¶ˆæ¯
3. å†åˆ‡æ¢åˆ° Context View æŸ¥çœ‹

### Q4: æˆªæ–­å†å²ä¸ºç©º
**æ­£å¸¸æƒ…å†µ**:
- å¦‚æœé¢„ç®—å……è¶³ï¼Œä¸ä¼šè§¦å‘æˆªæ–­
- æ–°å¯¹è¯é€šå¸¸ä¸ä¼šæœ‰æˆªæ–­

**è§¦å‘æˆªæ–­**:
1. å‘é€å¤§é‡æ¶ˆæ¯ï¼ˆ>20 æ¡ï¼‰
2. å¯ç”¨ RAG æŸ¥è¯¢å¤§é‡æ–‡æ¡£
3. ä½¿ç”¨å¤§å‹æ¨¡å‹ï¼ˆè¾ƒå°çš„é¢„ç®—ï¼‰

## ğŸ“¸ æˆªå›¾å‚è€ƒ

### Chat ç•Œé¢ - Safe çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model Controls â”‚ ğŸ“Š Budget: 5.4k/91.8k (6%)        â”‚
â”‚                â”‚ [ğŸŸ¢ Safe]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦æƒ…æ¨¡æ€æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Token Budget Breakdown                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ System Prompt:   1,000 (10.8%)  [â–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’]        â”‚
â”‚ Conversation:    3,200 (34.8%)  [â–ˆâ–ˆâ–ˆâ–’â–’â–’â–’â–’â–’â–’]        â”‚
â”‚ RAG Context:       800 ( 8.7%)  [â–ˆâ–’â–’â–’â–’â–’â–’â–’â–’â–’]        â”‚
â”‚ Memory Facts:      400 ( 4.3%)  [â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’]        â”‚
â”‚                                                      â”‚
â”‚ ğŸ’¡ Tip: Use /context to see detailed breakdown      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Context View - Budget æ ‡ç­¾é¡µ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Status] [Budget] [Operations] [Raw Data]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Configuration Source: Auto-derived (gpt-4o)          â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚Component â”‚ Budget â”‚ Used   â”‚ % Used  â”‚            â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚ â”‚ System   â”‚  1,000 â”‚    832 â”‚  83.2%  â”‚            â”‚
â”‚ â”‚ Window   â”‚  4,000 â”‚  2,124 â”‚  53.1%  â”‚            â”‚
â”‚ â”‚ RAG      â”‚  2,000 â”‚    456 â”‚  22.8%  â”‚            â”‚
â”‚ â”‚ Memory   â”‚  1,000 â”‚    121 â”‚  12.1%  â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ‰ éªŒè¯å®Œæˆ

å¦‚æœæ‰€æœ‰æ£€æŸ¥é¡¹éƒ½é€šè¿‡ï¼Œæ­å–œï¼ä»»åŠ¡ 5ï¼ˆè¿è¡Œæ—¶å¯è§†åŒ–ï¼‰å·²æˆåŠŸå®æ–½ï¼

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥ä¸Šé¢çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Šï¼š`TASK_5_RUNTIME_VISUALIZATION_REPORT.md`
3. è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š`python3 test_budget_visualization.py`
4. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°å’Œåç«¯æ—¥å¿—

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-30
