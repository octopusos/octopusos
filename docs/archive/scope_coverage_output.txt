========================================
Scope Coverage: Task Module Only
========================================

Scope: agentos/core/task/**
Tests: tests/unit/task/**

============================= test session starts ==============================
platform darwin -- Python 3.13.11, pytest-9.0.2, pluggy-1.6.0
rootdir: /Users/pangge/PycharmProjects/AgentOS
configfile: pyproject.toml
plugins: anyio-4.12.1, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 313 items

tests/unit/task/test_artifact_service.py ...............                 [  4%]
tests/unit/task/test_audit_service.py ....F.......F...                   [  9%]
tests/unit/task/test_cancel_handler.py .................                 [ 15%]
tests/unit/task/test_dependency_service.py ...............F...           [ 21%]
tests/unit/task/test_event_service.py EEEEEEEEE                          [ 24%]
tests/unit/task/test_path_filter.py FF..FF.FFFF..F.F.FFF.FFF...          [ 32%]
tests/unit/task/test_project_settings_inheritance.py ...............     [ 37%]
tests/unit/task/test_repo_context.py ...............................     [ 47%]
tests/unit/task/test_retry_strategy.py ................................. [ 58%]
..                                                                       [ 58%]
tests/unit/task/test_runner_audit_integration.py ..................      [ 64%]
tests/unit/task/test_state_machine_gates.py .............                [ 68%]
tests/unit/task/test_task_api_enforces_state_machine.py .FFFFFFFFFFFFFFF [ 73%]
FFFFFF.FFFFF                                                             [ 77%]
tests/unit/task/test_task_repo_service.py .....................          [ 84%]
tests/unit/task/test_task_rollback_rules.py FFFFFFFFFFFFFFFFFFF...FFFFFF [ 93%]
FFF                                                                      [ 94%]
tests/unit/task/test_timeout_manager.py ..................               [100%]

==================================== ERRORS ====================================
___________________ ERROR at setup of test_emit_event_basic ____________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
________________ ERROR at setup of test_seq_monotonic_increment ________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
_______________ ERROR at setup of test_concurrent_seq_generation _______________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
_________________ ERROR at setup of test_get_events_pagination _________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
___________________ ERROR at setup of test_get_latest_events ___________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
__________________ ERROR at setup of test_get_events_by_phase __________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
_________________ ERROR at setup of test_get_checkpoint_events _________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
_________________ ERROR at setup of test_convenience_functions _________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
___________________ ERROR at setup of test_event_validation ____________________
tests/unit/task/test_event_service.py:66: in temp_db
    conn.execute(statement)
E   sqlite3.OperationalError: cannot commit - no transaction is active
=================================== FAILURES ===================================
__________________ TestTaskAuditService.test_record_operation __________________
tests/unit/task/test_audit_service.py:208: in test_record_operation
    mock_db.execute.assert_called_once()
/opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:958: in assert_called_once
    raise AssertionError(msg)
E   AssertionError: Expected 'execute' to have been called once. Called 0 times.
------------------------------ Captured log call -------------------------------
WARNING  agentos.core.task.audit_service:audit_service.py:376 Audit dropped: task_id=task-123 not found in tasks table. This is expected if task creation failed or audit arrived before task. Event: repo_write
_________________ TestTaskAuditService.test_record_git_changes _________________
tests/unit/task/test_audit_service.py:358: in test_record_git_changes
    mock_db.execute.assert_called_once()
/opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py:958: in assert_called_once
    raise AssertionError(msg)
E   AssertionError: Expected 'execute' to have been called once. Called 0 times.
------------------------------ Captured log call -------------------------------
WARNING  agentos.core.task.audit_service:audit_service.py:376 Audit dropped: task_id=task-123 not found in tasks table. This is expected if task creation failed or audit arrived before task. Event: repo_write
________________________ test_detect_file_dependencies _________________________
tests/unit/task/test_dependency_service.py:470: in test_detect_file_dependencies
    assert len(dependencies) > 0
E   assert 0 > 0
E    +  where 0 = len([])
------------------------------ Captured log call -------------------------------
WARNING  agentos.core.task.audit_service:audit_service.py:376 Audit dropped: task_id=task-001 not found in tasks table. This is expected if task creation failed or audit arrived before task. Event: repo_write
WARNING  agentos.core.task.audit_service:audit_service.py:376 Audit dropped: task_id=task-002 not found in tasks table. This is expected if task creation failed or audit arrived before task. Event: repo_read
_________________ TestPathFilter.test_simple_pattern_matching __________________
tests/unit/task/test_path_filter.py:22: in test_simple_pattern_matching
    assert filter.is_allowed("src/main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('src/main.py')
E    +    where is_allowed = PathFilter(patterns=['src/**/*.py']).is_allowed
____________________ TestPathFilter.test_multiple_patterns _____________________
tests/unit/task/test_path_filter.py:35: in test_multiple_patterns
    assert filter.is_allowed("src/main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('src/main.py')
E    +    where is_allowed = PathFilter(patterns=['src/**/*.py', 'lib/**/*.py']).is_allowed
____________________ TestPathFilter.test_wildcard_patterns _____________________
tests/unit/task/test_path_filter.py:63: in test_wildcard_patterns
    assert filter.is_allowed("main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('main.py')
E    +    where is_allowed = PathFilter(patterns=['*.py']).is_allowed
____________________ TestPathFilter.test_recursive_wildcard ____________________
tests/unit/task/test_path_filter.py:70: in test_recursive_wildcard
    assert filter.is_allowed("test_main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('test_main.py')
E    +    where is_allowed = PathFilter(patterns=['**/test_*.py']).is_allowed
____________________ TestPathFilter.test_path_normalization ____________________
tests/unit/task/test_path_filter.py:87: in test_path_normalization
    assert filter.is_allowed("src\\main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('src\\main.py')
E    +    where is_allowed = PathFilter(patterns=['src/**/*.py']).is_allowed
_______________________ TestPathFilter.test_filter_files _______________________
tests/unit/task/test_path_filter.py:108: in test_filter_files
    assert "src/main.py" in filtered
E   AssertionError: assert 'src/main.py' in []
____________________ TestPathFilter.test_get_allowed_count _____________________
tests/unit/task/test_path_filter.py:121: in test_get_allowed_count
    assert count == 2
E   assert 0 == 2
_______________ TestPathFilter.test_complex_pattern_combination ________________
tests/unit/task/test_path_filter.py:136: in test_complex_pattern_combination
    assert filter.is_allowed("src/main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('src/main.py')
E    +    where is_allowed = PathFilter(patterns=['src/**/*.py', 'lib/**/*.py', '!**/*_test.py', '!**/test_*.py', '!tests/**']).is_allowed
___________________ TestPathFilterBuilder.test_builder_basic ___________________
tests/unit/task/test_path_filter.py:177: in test_builder_basic
    assert filter.is_allowed("src/main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('src/main.py')
E    +    where is_allowed = PathFilter(patterns=['src/**/*.py', 'lib/**/*.py']).is_allowed
________________ TestPathFilterBuilder.test_builder_include_all ________________
tests/unit/task/test_path_filter.py:199: in test_builder_include_all
    assert filter.is_allowed("main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('main.py')
E    +    where is_allowed = PathFilter(patterns=['**/*']).is_allowed
_______________ TestPathFilterFactories.test_create_path_filter ________________
tests/unit/task/test_path_filter.py:225: in test_create_path_filter
    assert filter.is_allowed("src/main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('src/main.py')
E    +    where is_allowed = PathFilter(patterns=['src/**/*.py']).is_allowed
____________ TestPathFilterFactories.test_create_full_access_filter ____________
tests/unit/task/test_path_filter.py:232: in test_create_full_access_filter
    assert filter.is_allowed("main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('main.py')
E    +    where is_allowed = PathFilter(patterns=['**/*']).is_allowed
_____________ TestPathFilterFactories.test_create_readonly_filter ______________
tests/unit/task/test_path_filter.py:239: in test_create_readonly_filter
    assert filter.is_allowed("src/main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('src/main.py')
E    +    where is_allowed = PathFilter(patterns=['src/**/*.py', 'lib/**/*.py']).is_allowed
____________________ TestPathFilterEdgeCases.test_root_file ____________________
tests/unit/task/test_path_filter.py:257: in test_root_file
    assert filter.is_allowed("main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('main.py')
E    +    where is_allowed = PathFilter(patterns=['*.py']).is_allowed
________________ TestPathFilterEdgeCases.test_pattern_with_dots ________________
tests/unit/task/test_path_filter.py:264: in test_pattern_with_dots
    assert filter.is_allowed("main.test.js")
E   AssertionError: assert False
E    +  where False = is_allowed('main.test.js')
E    +    where is_allowed = PathFilter(patterns=['**/*.test.js']).is_allowed
________________ TestPathFilterEdgeCases.test_case_sensitivity _________________
tests/unit/task/test_path_filter.py:274: in test_case_sensitivity
    assert filter.is_allowed("main.py")
E   AssertionError: assert False
E    +  where False = is_allowed('main.py')
E    +    where is_allowed = PathFilter(patterns=['**/*.py']).is_allowed
___________________ test_create_task_records_creation_audit ____________________
tests/unit/task/test_task_api_enforces_state_machine.py:134: in test_create_task_records_creation_audit
    assert row is not None
E   assert None is not None
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5285K4EV942SQ6ARFKB75E: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5285K4EV942SQ6ARFKB75E: Failed to route task 01KG5285K4EV942SQ6ARFKB75E: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_create_task_with_session_id _______________________
tests/unit/task/test_task_api_enforces_state_machine.py:143: in test_create_task_with_session_id
    task = task_service.create_draft_task(
agentos/core/task/service.py:210: in create_draft_task
    result_task_id = writer.submit(_write_task_to_db, timeout=10.0)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/db/writer.py:373: in submit
    raise result  # result is the exception
    ^^^^^^^^^^^^
agentos/core/db/writer.py:263: in _exec_with_retry
    result = fn(conn)
             ^^^^^^^^
agentos/core/task/service.py:161: in _write_task_to_db
    cursor.execute(
E   sqlite3.IntegrityError: FOREIGN KEY constraint failed
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.db.writer:writer.py:317 Write operation failed: FOREIGN KEY constraint failed
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/db/writer.py", line 263, in _exec_with_retry
    result = fn(conn)
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/service.py", line 161, in _write_task_to_db
    cursor.execute(
    ~~~~~~~~~~~~~~^
        """
        ^^^
    ...<20 lines>...
        ),
        ^^
    )
    ^
sqlite3.IntegrityError: FOREIGN KEY constraint failed
ERROR    agentos.core.task.service:service.py:213 Failed to create task in database: FOREIGN KEY constraint failed
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/service.py", line 210, in create_draft_task
    result_task_id = writer.submit(_write_task_to_db, timeout=10.0)
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/db/writer.py", line 373, in submit
    raise result  # result is the exception
    ^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/db/writer.py", line 263, in _exec_with_retry
    result = fn(conn)
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/service.py", line 161, in _write_task_to_db
    cursor.execute(
    ~~~~~~~~~~~~~~^
        """
        ^^^
    ...<20 lines>...
        ),
        ^^
    )
    ^
sqlite3.IntegrityError: FOREIGN KEY constraint failed
___________________________ test_approve_draft_task ____________________________
tests/unit/task/test_task_api_enforces_state_machine.py:164: in test_approve_draft_task
    approved_task = task_service.approve_task(
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5285PYSH3VH2AXKMBFQH2Q)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5285PYSH3VH2AXKMBFQH2Q: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5285PYSH3VH2AXKMBFQH2Q: Failed to route task 01KG5285PYSH3VH2AXKMBFQH2Q: No suitable instances found for task requirements: ['coding', 'testing']
___________________________ test_queue_approved_task ___________________________
tests/unit/task/test_task_api_enforces_state_machine.py:179: in test_queue_approved_task
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5285TBCDQFFJBEWKWQ11YZ)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5285TBCDQFFJBEWKWQ11YZ: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5285TBCDQFFJBEWKWQ11YZ: Failed to route task 01KG5285TBCDQFFJBEWKWQ11YZ: No suitable instances found for task requirements: ['coding', 'testing']
____________________________ test_start_queued_task ____________________________
tests/unit/task/test_task_api_enforces_state_machine.py:196: in test_start_queued_task
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5285XC08NCB72X635W9R10)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5285XC08NCB72X635W9R10: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5285XC08NCB72X635W9R10: Failed to route task 01KG5285XC08NCB72X635W9R10: No suitable instances found for task requirements: ['coding', 'testing']
__________________________ test_complete_running_task __________________________
tests/unit/task/test_task_api_enforces_state_machine.py:214: in test_complete_running_task
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52860DM2KH0370J69WH75G)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52860DM2KH0370J69WH75G: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52860DM2KH0370J69WH75G: Failed to route task 01KG52860DM2KH0370J69WH75G: No suitable instances found for task requirements: ['coding', 'testing']
_______________________________ test_verify_task _______________________________
tests/unit/task/test_task_api_enforces_state_machine.py:233: in test_verify_task
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52863D494S6JNDW35JXRGR)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52863D494S6JNDW35JXRGR: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52863D494S6JNDW35JXRGR: Failed to route task 01KG52863D494S6JNDW35JXRGR: No suitable instances found for task requirements: ['coding', 'testing']
_____________________________ test_mark_task_done ______________________________
tests/unit/task/test_task_api_enforces_state_machine.py:253: in test_mark_task_done
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52866F9ZZZGTMAA54J4JAM)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52866F9ZZZGTMAA54J4JAM: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52866F9ZZZGTMAA54J4JAM: Failed to route task 01KG52866F9ZZZGTMAA54J4JAM: No suitable instances found for task requirements: ['coding', 'testing']
____________________________ test_fail_running_task ____________________________
tests/unit/task/test_task_api_enforces_state_machine.py:274: in test_fail_running_task
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286A30CZWAT3ET6883XE7)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286A30CZWAT3ET6883XE7: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286A30CZWAT3ET6883XE7: Failed to route task 01KG5286A30CZWAT3ET6883XE7: No suitable instances found for task requirements: ['coding', 'testing']
____________________________ test_cancel_draft_task ____________________________
tests/unit/task/test_task_api_enforces_state_machine.py:294: in test_cancel_draft_task
    canceled_task = task_service.cancel_task(
agentos/core/task/service.py:584: in cancel_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286D4HPQ1A5HA8HADGMHZ)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286D4HPQ1A5HA8HADGMHZ: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286D4HPQ1A5HA8HADGMHZ: Failed to route task 01KG5286D4HPQ1A5HA8HADGMHZ: No suitable instances found for task requirements: ['coding', 'testing']
____________________________ test_retry_failed_task ____________________________
tests/unit/task/test_task_api_enforces_state_machine.py:309: in test_retry_failed_task
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286G64DBMXCKMR73BE887)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286G64DBMXCKMR73BE887: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286G64DBMXCKMR73BE887: Failed to route task 01KG5286G64DBMXCKMR73BE887: No suitable instances found for task requirements: ['coding', 'testing']
______________________ test_cannot_approve_approved_task _______________________
tests/unit/task/test_task_api_enforces_state_machine.py:333: in test_cannot_approve_approved_task
    task_service.approve_task(task.task_id, "approver", "Approved")
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286K97APQNTVXYRJ318H9)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286K97APQNTVXYRJ318H9: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286K97APQNTVXYRJ318H9: Failed to route task 01KG5286K97APQNTVXYRJ318H9: No suitable instances found for task requirements: ['coding', 'testing']
_________________________ test_cannot_queue_draft_task _________________________
tests/unit/task/test_task_api_enforces_state_machine.py:349: in test_cannot_queue_draft_task
    task_service.queue_task(task.task_id, "scheduler", "Queuing")
agentos/core/task/service.py:392: in queue_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286PAD8WPTTS6WH83RX90)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286PAD8WPTTS6WH83RX90: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286PAD8WPTTS6WH83RX90: Failed to route task 01KG5286PAD8WPTTS6WH83RX90: No suitable instances found for task requirements: ['coding', 'testing']
_________________________ test_cannot_start_draft_task _________________________
tests/unit/task/test_task_api_enforces_state_machine.py:362: in test_cannot_start_draft_task
    task_service.start_task(task.task_id, "runner", "Starting")
agentos/core/task/service.py:424: in start_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286SBGZCARC1H32YKEB0J)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286SBGZCARC1H32YKEB0J: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286SBGZCARC1H32YKEB0J: Failed to route task 01KG5286SBGZCARC1H32YKEB0J: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_cannot_complete_draft_task ________________________
tests/unit/task/test_task_api_enforces_state_machine.py:373: in test_cannot_complete_draft_task
    task_service.complete_task_execution(task.task_id, "runner", "Completing")
agentos/core/task/service.py:456: in complete_task_execution
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286WCVQS395Z6J5V6MR15)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286WCVQS395Z6J5V6MR15: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286WCVQS395Z6J5V6MR15: Failed to route task 01KG5286WCVQS395Z6J5V6MR15: No suitable instances found for task requirements: ['coding', 'testing']
________________________ test_cannot_verify_draft_task _________________________
tests/unit/task/test_task_api_enforces_state_machine.py:384: in test_cannot_verify_draft_task
    task_service.verify_task(task.task_id, "verifier", "Verifying")
agentos/core/task/service.py:488: in verify_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5286ZCWAMJC9G44NW6J2E5)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5286ZCWAMJC9G44NW6J2E5: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5286ZCWAMJC9G44NW6J2E5: Failed to route task 01KG5286ZCWAMJC9G44NW6J2E5: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_cannot_mark_draft_task_done _______________________
tests/unit/task/test_task_api_enforces_state_machine.py:395: in test_cannot_mark_draft_task_done
    task_service.mark_task_done(task.task_id, "user", "Done")
agentos/core/task/service.py:520: in mark_task_done
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52872D31Q4N6A4GGBPXYGZ)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52872D31Q4N6A4GGBPXYGZ: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52872D31Q4N6A4GGBPXYGZ: Failed to route task 01KG52872D31Q4N6A4GGBPXYGZ: No suitable instances found for task requirements: ['coding', 'testing']
______________________ test_cannot_retry_non_failed_task _______________________
tests/unit/task/test_task_api_enforces_state_machine.py:406: in test_cannot_retry_non_failed_task
    task_service.retry_failed_task(task.task_id, "user", "Retry")
agentos/core/task/service.py:702: in retry_failed_task
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52875FGP3SYKV1P5FNVVKY)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52875FGP3SYKV1P5FNVVKY: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52875FGP3SYKV1P5FNVVKY: Failed to route task 01KG52875FGP3SYKV1P5FNVVKY: No suitable instances found for task requirements: ['coding', 'testing']
_________________________ test_transitions_are_audited _________________________
tests/unit/task/test_task_api_enforces_state_machine.py:419: in test_transitions_are_audited
    task_service.approve_task(task.task_id, "approver", "Approved")
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52878B3FBRFQ82PM91BNJW)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52878B3FBRFQ82PM91BNJW: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52878B3FBRFQ82PM91BNJW: Failed to route task 01KG52878B3FBRFQ82PM91BNJW: No suitable instances found for task requirements: ['coding', 'testing']
______________________ test_invalid_transition_is_audited ______________________
tests/unit/task/test_task_api_enforces_state_machine.py:458: in test_invalid_transition_is_audited
    task_service.queue_task(task.task_id, "scheduler", "Invalid")
agentos/core/task/service.py:392: in queue_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5287BEAEAJ59YZV24XERDG)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5287BEAEAJ59YZV24XERDG: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5287BEAEAJ59YZV24XERDG: Failed to route task 01KG5287BEAEAJ59YZV24XERDG: No suitable instances found for task requirements: ['coding', 'testing']
________________________ test_transition_with_metadata _________________________
tests/unit/task/test_task_api_enforces_state_machine.py:494: in test_transition_with_metadata
    task_service.approve_task(
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5287EHY3VWWKZ9MZPSMF1T)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5287EHY3VWWKZ9MZPSMF1T: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5287EHY3VWWKZ9MZPSMF1T: Failed to route task 01KG5287EHY3VWWKZ9MZPSMF1T: No suitable instances found for task requirements: ['coding', 'testing']
__________________________ test_get_valid_transitions __________________________
tests/unit/task/test_task_api_enforces_state_machine.py:531: in test_get_valid_transitions
    valid_transitions = task_service.get_valid_transitions(task.task_id)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:816: in get_valid_transitions
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5287HQJ2CTENTYBYAWEE2Y)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5287HQJ2CTENTYBYAWEE2Y: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5287HQJ2CTENTYBYAWEE2Y: Failed to route task 01KG5287HQJ2CTENTYBYAWEE2Y: No suitable instances found for task requirements: ['coding', 'testing']
_________________ test_transition_to_same_state_is_idempotent __________________
tests/unit/task/test_task_api_enforces_state_machine.py:549: in test_transition_to_same_state_is_idempotent
    task_service.approve_task(task.task_id, "approver", "Approved")
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5287MKV1SC0EEQYE5ZST2Y)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5287MKV1SC0EEQYE5ZST2Y: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5287MKV1SC0EEQYE5ZST2Y: Failed to route task 01KG5287MKV1SC0EEQYE5ZST2Y: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_full_task_lifecycle_success _______________________
tests/unit/task/test_task_api_enforces_state_machine.py:577: in test_full_task_lifecycle_success
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5287QKERP49W7F3BFH2RGV)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5287QKERP49W7F3BFH2RGV: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5287QKERP49W7F3BFH2RGV: Failed to route task 01KG5287QKERP49W7F3BFH2RGV: No suitable instances found for task requirements: ['coding', 'testing']
__________________ test_full_task_lifecycle_failure_and_retry __________________
tests/unit/task/test_task_api_enforces_state_machine.py:608: in test_full_task_lifecycle_failure_and_retry
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5287TMXJFQ4FDXD86B8A03)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5287TMXJFQ4FDXD86B8A03: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5287TMXJFQ4FDXD86B8A03: Failed to route task 01KG5287TMXJFQ4FDXD86B8A03: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_task_lifecycle_cancellation _______________________
tests/unit/task/test_task_api_enforces_state_machine.py:632: in test_task_lifecycle_cancellation
    task1 = task_service.cancel_task(task1.task_id, "user", "Canceled from draft")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:584: in cancel_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5287XN2PZE9BJ94GA58HSD)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5287XN2PZE9BJ94GA58HSD: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5287XN2PZE9BJ94GA58HSD: Failed to route task 01KG5287XN2PZE9BJ94GA58HSD: No suitable instances found for task requirements: ['general']
__________________________ test_cancel_draft_success ___________________________
tests/unit/task/test_task_rollback_rules.py:124: in test_cancel_draft_success
    canceled_task = rollback_service.cancel_draft(
agentos/core/task/rollback.py:141: in cancel_draft
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52885105PT9EHZT8VXER63)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52885105PT9EHZT8VXER63: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52885105PT9EHZT8VXER63: Failed to route task 01KG52885105PT9EHZT8VXER63: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_cancel_draft_records_audit ________________________
tests/unit/task/test_task_rollback_rules.py:138: in test_cancel_draft_records_audit
    rollback_service.cancel_draft(
agentos/core/task/rollback.py:141: in cancel_draft
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52887TNHMQXZZ2TJMZSJX1)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52887TNHMQXZZ2TJMZSJX1: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52887TNHMQXZZ2TJMZSJX1: Failed to route task 01KG52887TNHMQXZZ2TJMZSJX1: No suitable instances found for task requirements: ['coding', 'testing']
_____________________ test_cancel_draft_rejects_non_draft ______________________
tests/unit/task/test_task_rollback_rules.py:167: in test_cancel_draft_rejects_non_draft
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288AKE14BW26MQ809Z07T)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288AKE14BW26MQ809Z07T: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288AKE14BW26MQ809Z07T: Failed to route task 01KG5288AKE14BW26MQ809Z07T: No suitable instances found for task requirements: ['coding', 'testing']
_________________________ test_cancel_approved_success _________________________
tests/unit/task/test_task_rollback_rules.py:183: in test_cancel_approved_success
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288DM8YVNP4QVZ5JM173D)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288DM8YVNP4QVZ5JM173D: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288DM8YVNP4QVZ5JM173D: Failed to route task 01KG5288DM8YVNP4QVZ5JM173D: No suitable instances found for task requirements: ['coding', 'testing']
_____________________ test_cancel_approved_requires_reason _____________________
tests/unit/task/test_task_rollback_rules.py:199: in test_cancel_approved_requires_reason
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288GQEWBHTHR98BJ0PZ03)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288GQEWBHTHR98BJ0PZ03: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288GQEWBHTHR98BJ0PZ03: Failed to route task 01KG5288GQEWBHTHR98BJ0PZ03: No suitable instances found for task requirements: ['coding', 'testing']
__________________ test_cancel_approved_rejects_non_approved ___________________
tests/unit/task/test_task_rollback_rules.py:215: in test_cancel_approved_rejects_non_approved
    rollback_service.cancel_approved(task.task_id, "user", "Cancel")
agentos/core/task/rollback.py:198: in cancel_approved
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288KVEN4DCS2JZDB931KG)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288KVEN4DCS2JZDB931KG: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288KVEN4DCS2JZDB931KG: Failed to route task 01KG5288KVEN4DCS2JZDB931KG: No suitable instances found for task requirements: ['coding', 'testing']
__________________________ test_cancel_queued_success __________________________
tests/unit/task/test_task_rollback_rules.py:227: in test_cancel_queued_success
    task = task_service.approve_task(task.task_id, "approver", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288PP1MDVHX14B10NF9HF)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288PP1MDVHX14B10NF9HF: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288PP1MDVHX14B10NF9HF: Failed to route task 01KG5288PP1MDVHX14B10NF9HF: No suitable instances found for task requirements: ['coding', 'testing']
____________________ test_cancel_queued_rejects_non_queued _____________________
tests/unit/task/test_task_rollback_rules.py:246: in test_cancel_queued_rejects_non_queued
    rollback_service.cancel_queued(task.task_id, "user", "Cancel")
agentos/core/task/rollback.py:255: in cancel_queued
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288SWJBP4ME6F23DVR48Y)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288SWJBP4ME6F23DVR48Y: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288SWJBP4ME6F23DVR48Y: Failed to route task 01KG5288SWJBP4ME6F23DVR48Y: No suitable instances found for task requirements: ['coding', 'testing']
________________________ test_restart_creates_new_task _________________________
tests/unit/task/test_task_rollback_rules.py:261: in test_restart_creates_new_task
    new_task = rollback_service.create_new_draft_from_task(
agentos/core/task/rollback.py:318: in create_new_draft_from_task
    raise TaskNotFoundError(source_task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288WNCPQASB50JP8H5KN5)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288WNCPQASB50JP8H5KN5: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288WNCPQASB50JP8H5KN5: Failed to route task 01KG5288WNCPQASB50JP8H5KN5: No suitable instances found for task requirements: ['general']
______________________ test_restart_preserves_source_info ______________________
tests/unit/task/test_task_rollback_rules.py:285: in test_restart_preserves_source_info
    task_service.approve_task(original_task.task_id, "approver", "Approved")
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5288ZJSP3FEE91TCN03GTS)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5288ZJSP3FEE91TCN03GTS: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5288ZJSP3FEE91TCN03GTS: Failed to route task 01KG5288ZJSP3FEE91TCN03GTS: No suitable instances found for task requirements: ['general']
_______________________ test_restart_with_title_override _______________________
tests/unit/task/test_task_rollback_rules.py:318: in test_restart_with_title_override
    new_task = rollback_service.create_new_draft_from_task(
agentos/core/task/rollback.py:318: in create_new_draft_from_task
    raise TaskNotFoundError(source_task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52892S3MKSRPC4GTBFBEMF)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52892S3MKSRPC4GTBFBEMF: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52892S3MKSRPC4GTBFBEMF: Failed to route task 01KG52892S3MKSRPC4GTBFBEMF: No suitable instances found for task requirements: ['general']
_________________________ test_restart_creates_lineage _________________________
tests/unit/task/test_task_rollback_rules.py:336: in test_restart_creates_lineage
    new_task = rollback_service.create_new_draft_from_task(
agentos/core/task/rollback.py:318: in create_new_draft_from_task
    raise TaskNotFoundError(source_task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52895Q8CFBVDWW2K8SPFGN)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52895Q8CFBVDWW2K8SPFGN: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52895Q8CFBVDWW2K8SPFGN: Failed to route task 01KG52895Q8CFBVDWW2K8SPFGN: No suitable instances found for task requirements: ['general']
________________________ test_restart_audits_both_tasks ________________________
tests/unit/task/test_task_rollback_rules.py:364: in test_restart_audits_both_tasks
    new_task = rollback_service.create_new_draft_from_task(
agentos/core/task/rollback.py:318: in create_new_draft_from_task
    raise TaskNotFoundError(source_task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG52898M5F6MJTC0W4TW886W)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG52898M5F6MJTC0W4TW886W: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG52898M5F6MJTC0W4TW886W: Failed to route task 01KG52898M5F6MJTC0W4TW886W: No suitable instances found for task requirements: ['general']
_________________________ test_restart_from_any_state __________________________
tests/unit/task/test_task_rollback_rules.py:407: in test_restart_from_any_state
    new_task = rollback_service.create_new_draft_from_task(
agentos/core/task/rollback.py:318: in create_new_draft_from_task
    raise TaskNotFoundError(source_task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5289BFS59XTGR07Q16B4K8)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5289BFS59XTGR07Q16B4K8: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5289BFS59XTGR07Q16B4K8: Failed to route task 01KG5289BFS59XTGR07Q16B4K8: No suitable instances found for task requirements: ['general']
____________________ test_can_cancel_returns_correct_values ____________________
tests/unit/task/test_task_rollback_rules.py:425: in test_can_cancel_returns_correct_values
    assert rollback_service.can_cancel(draft_task.task_id) is True
E   AssertionError: assert False is True
E    +  where False = can_cancel('01KG5289EBVQHNJ439QK868KDP')
E    +    where can_cancel = <agentos.core.task.rollback.TaskRollbackService object at 0x10ab075f0>.can_cancel
E    +    and   '01KG5289EBVQHNJ439QK868KDP' = Task(task_id='01KG5289EBVQHNJ439QK868KDP', title='Draft', status='draft', session_id='auto_01KG5289_1769696667', proje...:00'}}, exit_reason=None, route_plan_json=None, requirements_json=None, selected_instance_id=None, router_version=None).task_id
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5289EBVQHNJ439QK868KDP: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5289EBVQHNJ439QK868KDP: Failed to route task 01KG5289EBVQHNJ439QK868KDP: No suitable instances found for task requirements: ['general']
_________________________ test_can_restart_always_true _________________________
tests/unit/task/test_task_rollback_rules.py:451: in test_can_restart_always_true
    assert rollback_service.can_restart(task.task_id) is True
E   AssertionError: assert False is True
E    +  where False = can_restart('01KG5289H2BMHTZDFYPX02BJCT')
E    +    where can_restart = <agentos.core.task.rollback.TaskRollbackService object at 0x10aa59e50>.can_restart
E    +    and   '01KG5289H2BMHTZDFYPX02BJCT' = Task(task_id='01KG5289H2BMHTZDFYPX02BJCT', title='Test', status='draft', session_id='auto_01KG5289_1769696667', projec...:00'}}, exit_reason=None, route_plan_json=None, requirements_json=None, selected_instance_id=None, router_version=None).task_id
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5289H2BMHTZDFYPX02BJCT: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5289H2BMHTZDFYPX02BJCT: Failed to route task 01KG5289H2BMHTZDFYPX02BJCT: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_get_rollback_options_draft ________________________
tests/unit/task/test_task_rollback_rules.py:462: in test_get_rollback_options_draft
    options = rollback_service.get_rollback_options(task.task_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/rollback.py:436: in get_rollback_options
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5289M30QYE25EHENHFZ159)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5289M30QYE25EHENHFZ159: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5289M30QYE25EHENHFZ159: Failed to route task 01KG5289M30QYE25EHENHFZ159: No suitable instances found for task requirements: ['coding', 'testing']
______________________ test_get_rollback_options_approved ______________________
tests/unit/task/test_task_rollback_rules.py:475: in test_get_rollback_options_approved
    task = task_service.approve_task(task.task_id, "a", "r")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5289PWEPSSD09TP9JZHYP5)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5289PWEPSSD09TP9JZHYP5: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5289PWEPSSD09TP9JZHYP5: Failed to route task 01KG5289PWEPSSD09TP9JZHYP5: No suitable instances found for task requirements: ['coding', 'testing']
___________________ test_get_rollback_options_terminal_state ___________________
tests/unit/task/test_task_rollback_rules.py:487: in test_get_rollback_options_terminal_state
    task = task_service.cancel_task(task.task_id, "user", "Cancel")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:584: in cancel_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5289SY2FY3C9A9R9PSW32E)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5289SY2FY3C9A9R9PSW32E: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5289SY2FY3C9A9R9PSW32E: Failed to route task 01KG5289SY2FY3C9A9R9PSW32E: No suitable instances found for task requirements: ['coding', 'testing']
______________________ test_cannot_cancel_completed_task _______________________
tests/unit/task/test_task_rollback_rules.py:530: in test_cannot_cancel_completed_task
    task = task_service.approve_task(task.task_id, "a", "r")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG5289XDNDZTA8YM64N501HX)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG5289XDNDZTA8YM64N501HX: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG5289XDNDZTA8YM64N501HX: Failed to route task 01KG5289XDNDZTA8YM64N501HX: No suitable instances found for task requirements: ['coding', 'testing']
_________________ test_cannot_cancel_failed_task_via_rollback __________________
tests/unit/task/test_task_rollback_rules.py:548: in test_cannot_cancel_failed_task_via_rollback
    task = task_service.approve_task(task.task_id, "a", "r")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528A0G8K7BKX0WADK6AY5S)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528A0G8K7BKX0WADK6AY5S: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528A0G8K7BKX0WADK6AY5S: Failed to route task 01KG528A0G8K7BKX0WADK6AY5S: No suitable instances found for task requirements: ['coding', 'testing']
_________________ test_cannot_cancel_running_task_via_rollback _________________
tests/unit/task/test_task_rollback_rules.py:563: in test_cannot_cancel_running_task_via_rollback
    task = task_service.approve_task(task.task_id, "a", "r")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528A3JQCZ6RRJ3WP6ZE6VX)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528A3JQCZ6RRJ3WP6ZE6VX: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528A3JQCZ6RRJ3WP6ZE6VX: Failed to route task 01KG528A3JQCZ6RRJ3WP6ZE6VX: No suitable instances found for task requirements: ['coding', 'testing']
_______________________ test_rollback_uses_state_machine _______________________
tests/unit/task/test_task_rollback_rules.py:582: in test_rollback_uses_state_machine
    rollback_service.cancel_draft(task.task_id, "user", "Cancel")
agentos/core/task/rollback.py:141: in cancel_draft
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528A6NPX6607D2J7HDP3BE)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528A6NPX6607D2J7HDP3BE: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528A6NPX6607D2J7HDP3BE: Failed to route task 01KG528A6NPX6607D2J7HDP3BE: No suitable instances found for task requirements: ['coding', 'testing']
__________________ test_rollback_respects_state_machine_rules __________________
tests/unit/task/test_task_rollback_rules.py:602: in test_rollback_respects_state_machine_rules
    task = task_service.approve_task(task.task_id, "a", "r")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528A9HXEFZTZ2EK4FKWSEE)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528A9HXEFZTZ2EK4FKWSEE: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528A9HXEFZTZ2EK4FKWSEE: Failed to route task 01KG528A9HXEFZTZ2EK4FKWSEE: No suitable instances found for task requirements: ['coding', 'testing']
__________________________ test_cancel_with_metadata ___________________________
tests/unit/task/test_task_rollback_rules.py:622: in test_cancel_with_metadata
    rollback_service.cancel_draft(
agentos/core/task/rollback.py:141: in cancel_draft
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528ACKD4ENWC1WB2WX2R5V)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528ACKD4ENWC1WB2WX2R5V: No suitable instances found for task requirements: ['coding', 'testing']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding', 'testing']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528ACKD4ENWC1WB2WX2R5V: Failed to route task 01KG528ACKD4ENWC1WB2WX2R5V: No suitable instances found for task requirements: ['coding', 'testing']
________________ test_full_rollback_scenario_draft_to_canceled _________________
tests/unit/task/test_task_rollback_rules.py:657: in test_full_rollback_scenario_draft_to_canceled
    canceled_task = rollback_service.cancel_draft(
agentos/core/task/rollback.py:141: in cancel_draft
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528AFE6G5GSSB1WKJ8WWFZ)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528AFE6G5GSSB1WKJ8WWFZ: No suitable instances found for task requirements: ['coding']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528AFE6G5GSSB1WKJ8WWFZ: Failed to route task 01KG528AFE6G5GSSB1WKJ8WWFZ: No suitable instances found for task requirements: ['coding']
_______________ test_full_rollback_scenario_restart_failed_task ________________
tests/unit/task/test_task_rollback_rules.py:671: in test_full_rollback_scenario_restart_failed_task
    task = task_service.approve_task(task.task_id, "ops_lead", "Approved")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528AJ7EA1TA1X2ZYPCVSVZ)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528AJ7EA1TA1X2ZYPCVSVZ: No suitable instances found for task requirements: ['general']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['general']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528AJ7EA1TA1X2ZYPCVSVZ: Failed to route task 01KG528AJ7EA1TA1X2ZYPCVSVZ: No suitable instances found for task requirements: ['general']
_______ test_full_rollback_scenario_cancel_approved_requirements_changed _______
tests/unit/task/test_task_rollback_rules.py:705: in test_full_rollback_scenario_cancel_approved_requirements_changed
    approved_task = task_service.approve_task(
agentos/core/task/service.py:360: in approve_task
    return self.state_machine.transition(
agentos/core/task/state_machine.py:221: in transition
    raise TaskNotFoundError(task_id)
E   agentos.core.task.errors.TaskNotFoundError: Task not found (task_id: 01KG528AN90R8FWNVP36NNW8AX)
------------------------------ Captured log call -------------------------------
ERROR    agentos.core.task.routing_service:routing_service.py:102 Routing failed for task 01KG528AN90R8FWNVP36NNW8AX: No suitable instances found for task requirements: ['coding']
Traceback (most recent call last):
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/core/task/routing_service.py", line 73, in route_new_task
    plan = await self.router.route(task_id, task_spec)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/pangge/PycharmProjects/AgentOS/agentos/router/router.py", line 105, in route
    raise RuntimeError(
        f"No suitable instances found for task requirements: {requirements.needs}"
    )
RuntimeError: No suitable instances found for task requirements: ['coding']
WARNING  agentos.core.task.service:service.py:242 Task routing failed for task 01KG528AN90R8FWNVP36NNW8AX: Failed to route task 01KG528AN90R8FWNVP36NNW8AX: No suitable instances found for task requirements: ['coding']
=============================== warnings summary ===============================
agentos/schemas/project.py:15
  /Users/pangge/PycharmProjects/AgentOS/agentos/schemas/project.py:15: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class RiskProfile(BaseModel):

agentos/schemas/project.py:46
  /Users/pangge/PycharmProjects/AgentOS/agentos/schemas/project.py:46: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ProjectSettings(BaseModel):

tests/unit/task/test_artifact_service.py: 12 warnings
tests/unit/task/test_dependency_service.py: 2 warnings
  /Users/pangge/PycharmProjects/AgentOS/agentos/core/task/artifact_service.py:87: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "created_at": self.created_at or datetime.utcnow().isoformat(),

tests/unit/task/test_audit_service.py::TestTaskAudit::test_to_db_dict
tests/unit/task/test_audit_service.py::TestTaskAuditService::test_record_operation
tests/unit/task/test_audit_service.py::TestTaskAuditService::test_record_operation_task_level
tests/unit/task/test_audit_service.py::TestTaskAuditService::test_record_operation_with_error
tests/unit/task/test_audit_service.py::TestTaskAuditService::test_record_git_changes
tests/unit/task/test_dependency_service.py::test_detect_file_dependencies
tests/unit/task/test_dependency_service.py::test_detect_file_dependencies
  /Users/pangge/PycharmProjects/AgentOS/agentos/core/task/audit_service.py:127: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "created_at": self.created_at or datetime.utcnow().isoformat(),

tests/unit/task/test_dependency_service.py: 36 warnings
  /Users/pangge/PycharmProjects/AgentOS/agentos/core/task/dependency_service.py:647: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow().isoformat(),

tests/unit/task/test_project_settings_inheritance.py: 11 warnings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:113: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat(),

tests/unit/task/test_project_settings_inheritance.py: 11 warnings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:114: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat()

tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_runner_task_priority
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_runner_project_default
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_env
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_workdir_task_priority
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_workdir_project_default
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_check_operation_shell_write_allowed
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_check_operation_shell_write_denied
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_log_settings_inheritance
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_apply_project_settings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:141: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat(),

tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_runner_task_priority
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_runner_project_default
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_env
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_workdir_task_priority
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_get_effective_workdir_project_default
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_check_operation_shell_write_allowed
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_check_operation_shell_write_denied
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_log_settings_inheritance
tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_apply_project_settings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:142: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat(),

tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_check_operation_no_risk_profile
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:314: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat(),

tests/unit/task/test_project_settings_inheritance.py::TestProjectSettingsInheritance::test_check_operation_no_risk_profile
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:315: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat()

tests/unit/task/test_project_settings_inheritance.py::TestIntegration::test_different_projects_different_settings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:421: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat(),

tests/unit/task/test_project_settings_inheritance.py::TestIntegration::test_different_projects_different_settings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:422: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat()

tests/unit/task/test_project_settings_inheritance.py::TestIntegration::test_different_projects_different_settings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:432: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat(),

tests/unit/task/test_project_settings_inheritance.py::TestIntegration::test_different_projects_different_settings
  /Users/pangge/PycharmProjects/AgentOS/tests/unit/task/test_project_settings_inheritance.py:433: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    datetime.utcnow().isoformat()

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c7100>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c5a80>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c6020>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c46d0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c71f0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c4c70>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c5f30>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c5e40>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c55d0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c63e0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c49a0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c62f0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c65c0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c54e0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c4b80>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c75b0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c66b0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c72e0>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c4e50>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c6d40>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c5d50>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c5030>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c7880>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/unit/task/test_state_machine_gates.py::TestDoneStateGate::test_done_gate_with_insufficient_audits
  /opt/homebrew/Cellar/python@3.13/3.13.11_1/Frameworks/Python.framework/Versions/3.13/lib/python3.13/threading.py:303: ResourceWarning: unclosed database in <sqlite3.Connection object at 0x10a1c5b70>
    def __enter__(self):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.13.11-final-0 _______________

Name                                                Stmts   Miss Branch BrPart   Cover   Missing
------------------------------------------------------------------------------------------------
agentos/core/task/artifact_service.py                 110      7     22      5  89.39%   95->101, 98-99, 300->302, 333-336, 363->366, 395
agentos/core/task/artifact_service_v31.py             105    105     20      0   0.00%   9-313
agentos/core/task/audit_service.py                    166     35     36     13  74.26%   99, 135->141, 138-139, 203->207, 372, 385, 390-393, 414-415, 425-430, 451-452, 458-468, 473-478, 516->534, 518->525, 521->525, 525->534, 528->534, 531-532
agentos/core/task/binding_service.py                  162    162     64      0   0.00%   8-405
agentos/core/task/dependency_service.py               265     29     92     12  85.71%   90-92, 146, 157, 175, 181->180, 203, 209->208, 391->394, 436, 441-444, 513-514, 518-523, 547-569, 638, 841-844, 863->866
agentos/core/task/errors.py                            33     12      6      2  58.97%   33->35, 36-37, 65-72, 117, 146-150
agentos/core/task/event_service.py                    148    109     12      0  24.38%   36, 52, 75, 110-207, 237-260, 273-287, 303-317, 329-342, 356-370, 382-393, 406-420, 436-437, 460-461, 482-483, 506-507, 532-533, 558-559, 584-585
agentos/core/task/lineage_extensions.py                99     99     30      0   0.00%   3-330
agentos/core/task/manager.py                          220    172     26      1  20.73%   12-18, 79-180, 197-207, 230-263, 301-362, 380-400, 409-431, 445-470, 490-512, 524-546, 558-585, 648-667
agentos/core/task/manager_extended.py                  89     89     22      0   0.00%   3-260
agentos/core/task/models.py                           194     54     16      0  66.67%   39, 43, 47, 51, 55, 59-66, 70-77, 81, 85-91, 95-101, 105, 109-130, 143, 165, 169, 193, 197, 201, 205-206, 210, 365, 379-382, 420, 436-439
agentos/core/task/path_filter.py                      100      5     34      3  94.03%   64, 160, 231-234, 288->290
agentos/core/task/project_settings_inheritance.py     157     32     70     15  74.89%   72, 86, 94->97, 99-101, 163, 214->218, 226-227, 247-263, 277, 294->297, 297->301, 305->309, 313, 331->334, 339-340, 367, 426-433, 448-449, 469-470
agentos/core/task/repo_context.py                     139     19     52      7  84.29%   71, 104, 196-198, 211, 228-233, 242, 250, 303-305, 423-425
agentos/core/task/rollback.py                          99     51     28      6  42.52%   31-36, 68-69, 143-160, 200-217, 257-274, 321-381, 402, 438-465, 489-504
agentos/core/task/routing_service.py                   69     46     14      0  27.71%   76-99, 130-175, 197-236, 248-257, 274-282
agentos/core/task/run_mode.py                          57     25      8      0  49.23%   18, 22-30, 44-45, 49, 59, 69, 91-100, 105-115
agentos/core/task/runner_audit_integration.py          62      3      4      1  93.94%   154-156, 173->exit
agentos/core/task/runner_integration.py               101    101     36      0   0.00%   40-412
agentos/core/task/service.py                          166     72     24      5  54.21%   25-30, 114->117, 117->124, 218-226, 283-330, 552, 621-656, 705-751, 794, 818, 830, 845, 849, 853, 863, 890-899
agentos/core/task/spec_service.py                     131    131     30      0   0.00%   8-406
agentos/core/task/state_machine.py                    140     46     30      5  65.29%   106, 121-132, 150-151, 159, 168, 231-234, 315, 323-331, 371-381, 393-426, 438-441
agentos/core/task/states.py                            32      8      0      0  75.00%   47, 51, 106-110, 126
agentos/core/task/task_repo_service.py                126      5     38      4  94.51%   205->209, 281, 293, 300, 367-368
agentos/core/task/template_service.py                 150    150     40      0   0.00%   8-439
agentos/core/task/trace_builder.py                    100     83     52      0  11.18%   43-61, 74-88, 93-109, 113-126, 131-141, 145-160, 165, 170-182
agentos/core/task/work_items.py                       130    130     32      0   0.00%   19-325
------------------------------------------------------------------------------------------------
TOTAL                                                3541   1780    874     79  47.38%

4 files skipped due to complete coverage.
Coverage HTML written to dir htmlcov-scope
Coverage XML written to file coverage-scope.xml
=========================== short test summary info ============================
FAILED tests/unit/task/test_audit_service.py::TestTaskAuditService::test_record_operation
FAILED tests/unit/task/test_audit_service.py::TestTaskAuditService::test_record_git_changes
FAILED tests/unit/task/test_dependency_service.py::test_detect_file_dependencies
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_simple_pattern_matching
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_multiple_patterns
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_wildcard_patterns
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_recursive_wildcard
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_path_normalization
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_filter_files
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_get_allowed_count
FAILED tests/unit/task/test_path_filter.py::TestPathFilter::test_complex_pattern_combination
FAILED tests/unit/task/test_path_filter.py::TestPathFilterBuilder::test_builder_basic
FAILED tests/unit/task/test_path_filter.py::TestPathFilterBuilder::test_builder_include_all
FAILED tests/unit/task/test_path_filter.py::TestPathFilterFactories::test_create_path_filter
FAILED tests/unit/task/test_path_filter.py::TestPathFilterFactories::test_create_full_access_filter
FAILED tests/unit/task/test_path_filter.py::TestPathFilterFactories::test_create_readonly_filter
FAILED tests/unit/task/test_path_filter.py::TestPathFilterEdgeCases::test_root_file
FAILED tests/unit/task/test_path_filter.py::TestPathFilterEdgeCases::test_pattern_with_dots
FAILED tests/unit/task/test_path_filter.py::TestPathFilterEdgeCases::test_case_sensitivity
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_create_task_records_creation_audit
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_create_task_with_session_id
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_approve_draft_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_queue_approved_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_start_queued_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_complete_running_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_verify_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_mark_task_done
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_fail_running_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cancel_draft_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_retry_failed_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cannot_approve_approved_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cannot_queue_draft_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cannot_start_draft_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cannot_complete_draft_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cannot_verify_draft_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cannot_mark_draft_task_done
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_cannot_retry_non_failed_task
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_transitions_are_audited
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_invalid_transition_is_audited
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_transition_with_metadata
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_get_valid_transitions
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_transition_to_same_state_is_idempotent
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_full_task_lifecycle_success
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_full_task_lifecycle_failure_and_retry
FAILED tests/unit/task/test_task_api_enforces_state_machine.py::test_task_lifecycle_cancellation
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_draft_success
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_draft_records_audit
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_draft_rejects_non_draft
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_approved_success
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_approved_requires_reason
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_approved_rejects_non_approved
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_queued_success
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_queued_rejects_non_queued
FAILED tests/unit/task/test_task_rollback_rules.py::test_restart_creates_new_task
FAILED tests/unit/task/test_task_rollback_rules.py::test_restart_preserves_source_info
FAILED tests/unit/task/test_task_rollback_rules.py::test_restart_with_title_override
FAILED tests/unit/task/test_task_rollback_rules.py::test_restart_creates_lineage
FAILED tests/unit/task/test_task_rollback_rules.py::test_restart_audits_both_tasks
FAILED tests/unit/task/test_task_rollback_rules.py::test_restart_from_any_state
FAILED tests/unit/task/test_task_rollback_rules.py::test_can_cancel_returns_correct_values
FAILED tests/unit/task/test_task_rollback_rules.py::test_can_restart_always_true
FAILED tests/unit/task/test_task_rollback_rules.py::test_get_rollback_options_draft
FAILED tests/unit/task/test_task_rollback_rules.py::test_get_rollback_options_approved
FAILED tests/unit/task/test_task_rollback_rules.py::test_get_rollback_options_terminal_state
FAILED tests/unit/task/test_task_rollback_rules.py::test_cannot_cancel_completed_task
FAILED tests/unit/task/test_task_rollback_rules.py::test_cannot_cancel_failed_task_via_rollback
FAILED tests/unit/task/test_task_rollback_rules.py::test_cannot_cancel_running_task_via_rollback
FAILED tests/unit/task/test_task_rollback_rules.py::test_rollback_uses_state_machine
FAILED tests/unit/task/test_task_rollback_rules.py::test_rollback_respects_state_machine_rules
FAILED tests/unit/task/test_task_rollback_rules.py::test_cancel_with_metadata
FAILED tests/unit/task/test_task_rollback_rules.py::test_full_rollback_scenario_draft_to_canceled
FAILED tests/unit/task/test_task_rollback_rules.py::test_full_rollback_scenario_restart_failed_task
FAILED tests/unit/task/test_task_rollback_rules.py::test_full_rollback_scenario_cancel_approved_requirements_changed
ERROR tests/unit/task/test_event_service.py::test_emit_event_basic - sqlite3....
ERROR tests/unit/task/test_event_service.py::test_seq_monotonic_increment - s...
ERROR tests/unit/task/test_event_service.py::test_concurrent_seq_generation
ERROR tests/unit/task/test_event_service.py::test_get_events_pagination - sql...
ERROR tests/unit/task/test_event_service.py::test_get_latest_events - sqlite3...
ERROR tests/unit/task/test_event_service.py::test_get_events_by_phase - sqlit...
ERROR tests/unit/task/test_event_service.py::test_get_checkpoint_events - sql...
ERROR tests/unit/task/test_event_service.py::test_convenience_functions - sql...
ERROR tests/unit/task/test_event_service.py::test_event_validation - sqlite3....
=========== 73 failed, 231 passed, 129 warnings, 9 errors in 15.11s ============
