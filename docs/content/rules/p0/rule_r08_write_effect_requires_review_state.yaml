id: rule_r08_write_effect_requires_review_state
type: rule
title: "Commands with write effects must enter review state"
description: "Any command with effects.kind=write must transition to requires_review state. Direct execution of write operations is forbidden."
version: "0.9.0"
status: active

lineage:
  introduced_in: "v0.9"
  derived_from: null
  supersedes: []

constraints:
  execution: forbidden

rule:
  severity: error
  scope:
    applies_to_types: ["command"]
    applies_to_risk: ["medium", "high", "critical"]
    applies_to_phases: ["implementation", "validation", "review"]

  when:
    all_of:
      - effect_kind_is_write: true
      - state_not_requires_review: true

  then:
    decision: require_review
    reason: "Write effects must be reviewed before execution for safety"
    required_changes:
      - "Transition command to requires_review state"
      - "Collect evidence for review (diff, intent, rationale)"
      - "Wait for approval before execution"

  evidence_required:
    - "command_effects"
    - "state_transition_log"
    - "approval_metadata"

metadata:
  tags: ["write", "review", "safety"]
  author: "AgentOS Team"
