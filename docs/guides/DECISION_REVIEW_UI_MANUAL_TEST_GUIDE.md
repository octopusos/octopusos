# Decision Review UI - 手动测试指南

## 前置条件

1. ✅ 确保所有文件已正确创建（运行 `./verify_decision_review_ui.sh`）
2. ✅ BrainOS 数据库已构建（如果要看到真实数据）
   ```bash
   agentos brain build
   ```

## 测试步骤

### 步骤 1: 启动 WebUI 服务器
```bash
cd /Users/pangge/PycharmProjects/AgentOS
agentos webui
```

预期输出：
```
AgentOS WebUI starting on http://0.0.0.0:8000
```

### 步骤 2: 访问 WebUI
1. 打开浏览器
2. 访问 http://localhost:8000
3. 等待页面加载完成

✅ **检查点**：页面正常加载，无 JavaScript 错误

### 步骤 3: 导航到 Decision Review
1. 在左侧导航栏找到 "Governance" 部分
2. 点击 "Decision Review" 链接

✅ **检查点**：
- 导航链接存在
- 点击后页面切换到 Decision Review 视图
- 无控制台错误

### 步骤 4: 测试空状态（如果没有数据）
如果没有决策记录，应该看到：
- 左侧时间线列表显示 "没有找到决策记录" 或 "加载中..."
- 右侧详情面板显示空状态图标和提示文字

✅ **检查点**：
- 空状态提示友好
- 无错误消息
- UI 布局正常

### 步骤 5: 测试决策列表（如果有数据）
如果有决策记录，应该看到：
- 左侧显示决策卡片列表
- 每个卡片显示：
  - 决策类型（NAVIGATION/COMPARE/HEALTH）
  - Seed 查询内容
  - 时间戳（相对时间）
  - 状态标签（颜色编码）
  - 治理动作标签（颜色编码）
  - 置信度分数（如果有）

✅ **检查点**：
- 列表正常加载
- 卡片样式美观
- 状态标签颜色正确
- 计数显示正确

### 步骤 6: 测试过滤器
1. 使用类型过滤器选择不同类型（NAVIGATION/COMPARE/HEALTH）
2. 使用状态过滤器选择不同状态（PENDING/APPROVED/BLOCKED/SIGNED/FAILED）

✅ **检查点**：
- 过滤器工作正常
- 列表实时更新
- 计数更新正确

### 步骤 7: 测试决策详情
1. 点击任意决策卡片
2. 查看右侧详情面板

✅ **检查点**：
- 详情面板正常加载
- 选中的卡片高亮显示
- 详情包含以下部分：
  - 基本信息（类型、ID、时间、置信度）
  - 完整性验证（✅ Verified 或 ❌ Integrity Broken）
  - 触发的规则（如果有）
  - 签字信息（如果已签字）
  - 重放对比（左右分屏）
  - 审计追踪

### 步骤 8: 测试重放对比（如果有）
查看详情面板中的"认知对比"部分：
- 左侧：当时认知
- 右侧：当前认知
- 底部：变化的事实列表（如果有）

✅ **检查点**：
- 左右对比面板显示正常
- 内容格式正确
- 变化高亮显示（如果有）

### 步骤 9: 测试完整性验证
查看决策详情中的完整性验证区域：
- 如果通过：显示 ✅ Verified（绿色）
- 如果失败：显示 ❌ Integrity Broken（红色）

✅ **检查点**：
- 完整性状态显示正确
- 颜色编码清晰

### 步骤 10: 测试签字功能（如果有 REQUIRE_SIGNOFF 决策）
1. 找到状态为 PENDING 且治理动作为 REQUIRE_SIGNOFF 的决策
2. 点击详情面板底部的橙色 "Sign Off" 按钮
3. 填写签字表单：
   - 签字人：输入测试名称
   - 备注：输入测试备注
4. 点击"确认签字"

✅ **检查点**：
- 签字按钮显示条件正确
- 模态框正常弹出
- 表单验证工作（空字段提示）
- 提交成功后：
  - 模态框关闭
  - 列表刷新
  - 状态更新为 SIGNED
  - 详情显示签字信息

### 步骤 11: 测试响应式布局
1. 调整浏览器窗口大小
2. 测试不同屏幕尺寸（桌面、平板、移动）

✅ **检查点**：
- 布局适配良好
- 无横向滚动条（移动端除外）
- 内容可读性良好

### 步骤 12: 测试刷新功能
1. 点击顶部的 "Refresh" 按钮

✅ **检查点**：
- 列表重新加载
- 无错误
- 状态更新

## 测试结果记录

### 功能测试矩阵

| 功能 | 测试结果 | 备注 |
|------|---------|------|
| 页面加载 | ⬜ | |
| 导航切换 | ⬜ | |
| 空状态显示 | ⬜ | |
| 决策列表加载 | ⬜ | |
| 类型过滤 | ⬜ | |
| 状态过滤 | ⬜ | |
| 决策详情加载 | ⬜ | |
| 完整性验证显示 | ⬜ | |
| 触发规则显示 | ⬜ | |
| 重放对比显示 | ⬜ | |
| 签字按钮显示 | ⬜ | |
| 签字表单验证 | ⬜ | |
| 签字提交 | ⬜ | |
| 签字状态更新 | ⬜ | |
| 刷新功能 | ⬜ | |
| 响应式布局 | ⬜ | |

### 浏览器兼容性测试

| 浏览器 | 版本 | 测试结果 | 备注 |
|--------|------|---------|------|
| Chrome | ⬜ | ⬜ | |
| Firefox | ⬜ | ⬜ | |
| Safari | ⬜ | ⬜ | |
| Edge | ⬜ | ⬜ | |

## 常见问题排查

### 问题 1: 页面显示 "DecisionReviewView not loaded"
**原因**：JavaScript 文件未正确加载

**解决**：
1. 检查浏览器控制台是否有 404 错误
2. 确认 index.html 中引用了 DecisionReviewView.js
3. 清除浏览器缓存，强制刷新（Ctrl+Shift+R 或 Cmd+Shift+R）

### 问题 2: API 返回 404
**原因**：BrainOS 数据库不存在

**解决**：
```bash
agentos brain build
```

### 问题 3: 样式显示不正常
**原因**：CSS 文件未加载

**解决**：
1. 检查 index.html 是否引用了 decision-review.css
2. 清除浏览器缓存
3. 检查文件路径是否正确

### 问题 4: 签字按钮不显示
**原因**：没有符合条件的决策

**解决**：
- 这是正常情况
- 签字按钮只在 status=PENDING 且 final_verdict=REQUIRE_SIGNOFF 时显示
- 需要创建测试数据或等待真实决策触发

### 问题 5: JavaScript 控制台错误
**原因**：代码错误或 API 调用失败

**解决**：
1. 查看完整错误消息
2. 检查网络请求是否成功
3. 检查后端 API 是否正常运行

## 性能测试

### 加载性能
- [ ] 列表加载时间 < 1秒（100条记录）
- [ ] 详情加载时间 < 500ms
- [ ] 重放加载时间 < 1秒
- [ ] 页面切换流畅无卡顿

### 内存使用
- [ ] 长时间使用无内存泄漏
- [ ] 切换视图后资源正确释放

## 安全测试

### XSS 防护
- [ ] 决策内容正确转义
- [ ] 用户输入正确转义（签字表单）
- [ ] 无 innerHTML 注入风险

### CSRF 防护
- [ ] POST 请求包含 CSRF token（如果启用）

## 验收签字

### 开发者验收
- 姓名：_______________
- 日期：_______________
- 签字：_______________

### 测试者验收
- 姓名：_______________
- 日期：_______________
- 签字：_______________

### 产品验收
- 姓名：_______________
- 日期：_______________
- 签字：_______________

---

**测试完成后，请提交：**
1. 填写完整的测试结果记录
2. 截图证据（至少 3 张）
3. 发现的问题列表（如果有）
4. 改进建议（如果有）
