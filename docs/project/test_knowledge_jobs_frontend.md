# Knowledge Jobs å‰ç«¯æµ‹è¯•æŒ‡å—

## âœ… ä¿®æ”¹æ‘˜è¦

### å·²å®Œæˆçš„ä¼˜åŒ–ï¼š

1. **è½®è¯¢é—´éš”ä¼˜åŒ–**: 5 ç§’ â†’ 2 ç§’
   - æ›´å¿«çš„å®æ—¶æ›´æ–°ä½“éªŒ
   - å‡å°‘ç”¨æˆ·ç­‰å¾…æ—¶é—´

2. **çŠ¶æ€æ˜¾ç¤ºæ”¹è¿›**: "Created" â†’ "Pending..."
   - æ›´å‹å¥½çš„ç”¨æˆ·ç•Œé¢
   - æ›´æ¸…æ™°çš„çŠ¶æ€è¡¨è¾¾

3. **WebSocket äº‹ä»¶å¤„ç†å¢å¼º**:
   - æ·»åŠ  payload é˜²å¾¡æ€§æ£€æŸ¥
   - è‡ªåŠ¨å°† 'created' â†’ 'in_progress' çŠ¶æ€è½¬æ¢
   - æ›´å¥å£®çš„é”™è¯¯å¤„ç†

4. **Loading çŠ¶æ€ä¼˜åŒ–**:
   - é¦–æ¬¡åŠ è½½æ—¶çš„åŠ è½½çŠ¶æ€ç®¡ç†
   - é¿å…ç©ºç™½å±å¹•

---

## ğŸ§ª æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1: åŸºæœ¬åŠŸèƒ½æµ‹è¯•

#### 1.1 å¯åŠ¨æœåŠ¡å™¨
```bash
cd /Users/pangge/PycharmProjects/AgentOS
python -m agentos.webui.start
```

#### 1.2 æ‰“å¼€æµè§ˆå™¨
1. è®¿é—® `http://localhost:8000`
2. ç‚¹å‡»ä¾§è¾¹æ çš„ "Knowledge Jobs" (æˆ– "Index Jobs")

#### 1.3 éªŒè¯åˆå§‹åŠ è½½
- [ ] é¡µé¢åŠ è½½æ— é”™è¯¯
- [ ] æ˜¾ç¤ºç©ºåˆ—è¡¨æç¤º: "No index jobs found. Trigger a job to get started."
- [ ] 4 ä¸ªæŒ‰é’®æ­£å¸¸æ˜¾ç¤º: Incremental, Rebuild, Repair, Vacuum

---

### æµ‹è¯• 2: è§¦å‘ Job å¹¶éªŒè¯çŠ¶æ€æ›´æ–°

#### 2.1 è§¦å‘ Incremental Job
1. ç‚¹å‡» "Incremental" æŒ‰é’®
2. è§‚å¯Ÿä»¥ä¸‹è¡Œä¸ºï¼š

**é¢„æœŸç»“æœ**:
- [ ] Toast æç¤º: "incremental job triggered successfully"
- [ ] çº¦ 0.5 ç§’åï¼Œè¡¨æ ¼ä¸­å‡ºç°æ–°çš„ job è¡Œ
- [ ] åˆå§‹çŠ¶æ€æ˜¾ç¤º: **"Pending..."** (è“è‰² badge)
- [ ] Job ID æ˜¾ç¤ºå‰ 8 ä¸ªå­—ç¬¦
- [ ] Type æ˜¾ç¤º "Incremental" (è“è‰² badge)

#### 2.2 è§‚å¯ŸçŠ¶æ€è½¬æ¢
**æ—¶é—´è½´** (é¢„æœŸ):
```
T+0s:    Status: Pending...     Progress: 0%
T+0.5s:  Status: In Progress    Progress: 5%
T+2s:    Status: In Progress    Progress: 20-60%
T+4s:    Status: In Progress    Progress: 80-100%
T+5s:    Status: Completed      Progress: 100%
```

**éªŒè¯ç‚¹**:
- [ ] çŠ¶æ€ä» "Pending..." è‡ªåŠ¨å˜ä¸º "In Progress"
- [ ] è¿›åº¦æ¡ä» 0% é€æ­¥å¢åŠ åˆ° 100%
- [ ] è¿›åº¦æ¶ˆæ¯å®æ—¶æ›´æ–° (å¦‚: "Scanning for changed files...", "Indexing documents...")
- [ ] Files/Chunks è®¡æ•°å™¨å®æ—¶å¢åŠ 
- [ ] å®ŒæˆåçŠ¶æ€å˜ä¸º "Completed" (ç»¿è‰² badge)
- [ ] Duration æ˜¾ç¤ºæ ¼å¼æ­£ç¡® (å¦‚: "2s" æˆ– "1m 30s")

#### 2.3 éªŒè¯è½®è¯¢æœºåˆ¶
**æµ‹è¯•æ–¹æ³•**: æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12) â†’ Network æ ‡ç­¾

**è§‚å¯Ÿ**:
- [ ] æ¯ 2 ç§’è‡ªåŠ¨è°ƒç”¨ `/api/knowledge/jobs?limit=100`
- [ ] ä»…å½“æœ‰ in_progress æˆ– created çŠ¶æ€çš„ job æ—¶æ‰è½®è¯¢
- [ ] job å®Œæˆåï¼Œè½®è¯¢åœæ­¢

---

### æµ‹è¯• 3: WebSocket å®æ—¶æ›´æ–°

#### 3.1 éªŒè¯ WebSocket è¿æ¥
**æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°** (F12 â†’ Console)

**é¢„æœŸæ—¥å¿—**:
```
KnowledgeJobsView: WebSocket connected
EventStreamManager subscribed to EventBus
Event stream client connected: <uuid>
```

#### 3.2 è§¦å‘ Rebuild Job (è¾ƒæ…¢çš„ä»»åŠ¡)
1. ç‚¹å‡» "Rebuild" æŒ‰é’®
2. **ä¸è¦åˆ·æ–°é¡µé¢**
3. è§‚å¯Ÿè¡¨æ ¼å®æ—¶æ›´æ–°

**é¢„æœŸè¡Œä¸º**:
- [ ] è¿›åº¦æ¡å¹³æ»‘æ›´æ–° (æ— éœ€æ‰‹åŠ¨åˆ·æ–°)
- [ ] æ¶ˆæ¯å®æ—¶æ˜¾ç¤º
- [ ] WebSocket äº‹ä»¶åœ¨æ§åˆ¶å°å¯è§:
  ```javascript
  KnowledgeJobsView: WebSocket message received: {type: 'task.progress', ...}
  ```

---

### æµ‹è¯• 4: å¤š Job å¹¶å‘æµ‹è¯•

#### 4.1 å¿«é€Ÿè§¦å‘å¤šä¸ª Job
1. ä¾æ¬¡ç‚¹å‡»: Incremental â†’ Repair â†’ Vacuum
2. ç­‰å¾… 1 ç§’åå†æ¬¡ç‚¹å‡» Incremental

**é¢„æœŸç»“æœ**:
- [ ] è¡¨æ ¼æ˜¾ç¤º 4 ä¸ª job (æœ€æ–°çš„åœ¨æœ€å‰é¢)
- [ ] æ¯ä¸ª job ç‹¬ç«‹æ›´æ–°è¿›åº¦
- [ ] æ²¡æœ‰çŠ¶æ€æ··ä¹±æˆ–å†²çª
- [ ] è½®è¯¢æŒç»­è¿›è¡Œç›´åˆ°æ‰€æœ‰ job å®Œæˆ

#### 4.2 éªŒè¯è½®è¯¢ä¼˜åŒ–
**éªŒè¯**: æ‰€æœ‰ job å®Œæˆå
- [ ] è½®è¯¢è‡ªåŠ¨åœæ­¢ (Network æ ‡ç­¾æ— æ–°è¯·æ±‚)
- [ ] è¡¨æ ¼ä»ç„¶æ˜¾ç¤ºå®Œæ•´çš„ job åˆ—è¡¨

---

### æµ‹è¯• 5: Job è¯¦æƒ…æŠ½å±‰

#### 5.1 æ‰“å¼€ Job è¯¦æƒ…
1. ç‚¹å‡»ä»»æ„ job è¡Œ
2. å³ä¾§æŠ½å±‰å¼¹å‡º

**é¢„æœŸå†…å®¹**:
- [ ] Job ID (å®Œæ•´)
- [ ] Type badge
- [ ] Status badge
- [ ] Progress è¿›åº¦æ¡ + æ¶ˆæ¯
- [ ] Statistics:
  - Files Processed
  - Chunks Processed
  - Errors
  - Duration
- [ ] Timeline (Created, Updated)
- [ ] Related links (Events, Logs)

#### 5.2 å®æ—¶æ›´æ–°éªŒè¯
**å¦‚æœ job ä»åœ¨è¿è¡Œ**:
- [ ] æŠ½å±‰å†…çš„è¿›åº¦æ¡å®æ—¶æ›´æ–°
- [ ] Statistics å®æ—¶å¢åŠ 
- [ ] Status è‡ªåŠ¨å˜åŒ–

---

### æµ‹è¯• 6: é”™è¯¯å¤„ç†

#### 6.1 æ¨¡æ‹Ÿ API é”™è¯¯
**æ–¹æ³•**: åœ¨ job è¿è¡Œæ—¶åœæ­¢åç«¯æœåŠ¡å™¨

**é¢„æœŸè¡Œä¸º**:
- [ ] Toast é”™è¯¯æç¤º: "Failed to load jobs: ..."
- [ ] æ§åˆ¶å°æ˜¾ç¤ºé”™è¯¯æ—¥å¿—
- [ ] é¡µé¢ä¸å´©æºƒ
- [ ] é‡å¯æœåŠ¡å™¨åæ¢å¤æ­£å¸¸

#### 6.2 WebSocket æ–­å¼€é‡è¿
**æ–¹æ³•**: åœæ­¢åç«¯ â†’ ç­‰å¾… 5 ç§’ â†’ é‡å¯åç«¯

**é¢„æœŸè¡Œä¸º**:
- [ ] æ§åˆ¶å°æ˜¾ç¤º: "WebSocket closed"
- [ ] 5 ç§’åè‡ªåŠ¨é‡è¿
- [ ] é‡è¿åå®æ—¶æ›´æ–°æ¢å¤

---

### æµ‹è¯• 7: ç”¨æˆ·ä½“éªŒéªŒè¯

#### 7.1 ç©ºåˆ—è¡¨å‹å¥½æç¤º
**æ¸…ç©ºæ‰€æœ‰ jobs**:
```bash
# å¦‚æœæœ‰æ¸…ç©ºåŠŸèƒ½ï¼Œä½¿ç”¨å®ƒï¼›å¦åˆ™è·³è¿‡æ­¤æµ‹è¯•
```

**éªŒè¯**:
- [ ] æ˜¾ç¤º: "No index jobs found. Trigger a job to get started."
- [ ] æŒ‰é’®å¯ç”¨

#### 7.2 å¿«é€Ÿåˆ·æ–°æµ‹è¯•
1. æœ‰è¿è¡Œä¸­çš„ job æ—¶
2. å¿«é€Ÿç‚¹å‡» "Refresh" æŒ‰é’® 3-5 æ¬¡

**é¢„æœŸè¡Œä¸º**:
- [ ] é¡µé¢ä¸å¡é¡¿
- [ ] æ•°æ®æ­£ç¡®æ›´æ–°
- [ ] æ—  JavaScript é”™è¯¯

#### 7.3 é¡µé¢åˆ‡æ¢æµ‹è¯•
1. è§¦å‘ 1 ä¸ª Incremental job
2. åˆ‡æ¢åˆ° "Events" æˆ–å…¶ä»–é¡µé¢
3. ç­‰å¾… 5 ç§’
4. åˆ‡æ¢å› "Knowledge Jobs"

**é¢„æœŸè¡Œä¸º**:
- [ ] job çŠ¶æ€å·²æ›´æ–°
- [ ] è¡¨æ ¼æ˜¾ç¤ºæœ€æ–°æ•°æ®
- [ ] WebSocket é‡æ–°è¿æ¥ (å¦‚æœ‰éœ€è¦)

---

## ğŸ” æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥

### å…³é”®æ—¥å¿—æ¶ˆæ¯

**æ­£å¸¸æµç¨‹åº”çœ‹åˆ°**:
```javascript
// WebSocket è¿æ¥
KnowledgeJobsView: WebSocket connected

// è§¦å‘ job
POST /api/knowledge/jobs 200

// è½®è¯¢
GET /api/knowledge/jobs?limit=100 200 (æ¯ 2 ç§’)

// WebSocket äº‹ä»¶
KnowledgeJobsView: WebSocket message received: {
  type: 'task.progress',
  payload: { progress: 42, message: '...' }
}
```

### ä¸åº”å‡ºç°çš„é”™è¯¯

âŒ **ä»¥ä¸‹é”™è¯¯éœ€è¦ä¿®å¤**:
```javascript
// é”™è¯¯ç¤ºä¾‹
TypeError: Cannot read property 'progress' of undefined
WebSocket is already in CLOSING or CLOSED state
Failed to parse WebSocket message
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡å€¼
- è½®è¯¢é—´éš”: 2 ç§’
- WebSocket å»¶è¿Ÿ: < 100ms
- UI æ›´æ–°å»¶è¿Ÿ: < 200ms
- è¡¨æ ¼æ¸²æŸ“: < 500ms (100 jobs)

### æµ‹é‡æ–¹æ³•
**ä½¿ç”¨æµè§ˆå™¨ Performance æ ‡ç­¾**:
1. å¼€å§‹å½•åˆ¶
2. è§¦å‘ job
3. ç­‰å¾…å®Œæˆ
4. åœæ­¢å½•åˆ¶
5. æ£€æŸ¥ FPSã€å†…å­˜ã€ç½‘ç»œ

---

## âœ… éªŒæ”¶æ ‡å‡†

### å¿…é¡»é€šè¿‡çš„æµ‹è¯•
1. [x] è½®è¯¢é—´éš”ä¸º 2 ç§’
2. [ ] çŠ¶æ€æ˜¾ç¤º "Pending..." è€Œä¸æ˜¯ "Created"
3. [ ] WebSocket å®æ—¶æ›´æ–°æ­£å¸¸
4. [ ] è¿›åº¦æ¡æµç•…å¢é•¿
5. [ ] å¤š job å¹¶å‘æ— å†²çª
6. [ ] é”™è¯¯å¤„ç†ä¸å´©æºƒ
7. [ ] ç©ºåˆ—è¡¨æç¤ºå‹å¥½
8. [ ] Job è¯¦æƒ…å®æ—¶æ›´æ–°

### æ¨èçš„é™„åŠ æµ‹è¯•
- [ ] é•¿æ—¶é—´è¿è¡Œ (10+ åˆ†é’Ÿ) æ— å†…å­˜æ³„æ¼
- [ ] 100+ jobs åˆ—è¡¨æ€§èƒ½è‰¯å¥½
- [ ] ç½‘ç»œæ…¢é€Ÿä¸‹ä½“éªŒå¯æ¥å—
- [ ] ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€æ­£å¸¸

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### å½“å‰æ¶æ„é™åˆ¶
1. **WebSocket è¿æ¥ç®¡ç†**:
   - å½“å‰å®ç°è¦†ç›–å…¨å±€ onmessage
   - å¯èƒ½å¯¼è‡´å¤šè§†å›¾åˆ‡æ¢æ—¶äº‹ä»¶é‡å¤
   - **å»ºè®®**: æœªæ¥é‡æ„ä¸º EventBus æ¨¡å¼

2. **è½®è¯¢ä¸ WebSocket å†—ä½™**:
   - åŒæ—¶ä½¿ç”¨è½®è¯¢å’Œ WebSocket
   - ç†è®ºä¸Š WebSocket è¶³å¤Ÿï¼Œä½†è½®è¯¢æä¾›å…œåº•
   - **å»ºè®®**: ç›‘æ§ WebSocket å¯é æ€§åå¯ç§»é™¤è½®è¯¢

3. **çŠ¶æ€è½¬æ¢æ—¶æœº**:
   - created â†’ in_progress ä¾èµ–å‰ç«¯é€»è¾‘
   - **å»ºè®®**: åç«¯åœ¨ _run_index_job å¼€å§‹æ—¶ç«‹å³æ›´æ–°çŠ¶æ€

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

**æµ‹è¯•æ—¥æœŸ**: _________
**æµ‹è¯•äººå‘˜**: _________
**æµè§ˆå™¨**: Chrome/Firefox/Safari _____
**æ“ä½œç³»ç»Ÿ**: macOS/Windows/Linux

### æµ‹è¯•ç»“æœ
| æµ‹è¯•é¡¹ | é€šè¿‡ | å¤±è´¥ | å¤‡æ³¨ |
|--------|------|------|------|
| åŸºæœ¬åŠŸèƒ½ | â˜ | â˜ |  |
| çŠ¶æ€æ›´æ–° | â˜ | â˜ |  |
| WebSocket | â˜ | â˜ |  |
| å¤š Job å¹¶å‘ | â˜ | â˜ |  |
| Job è¯¦æƒ… | â˜ | â˜ |  |
| é”™è¯¯å¤„ç† | â˜ | â˜ |  |
| ç”¨æˆ·ä½“éªŒ | â˜ | â˜ |  |

### å‘ç°çš„é—®é¢˜
1.
2.
3.

### å»ºè®®æ”¹è¿›
1.
2.
3.

---

**å®Œæˆæµ‹è¯•åè¯·æŠ¥å‘Šç»“æœï¼** ğŸ‰
