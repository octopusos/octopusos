# AgentOS v0.3.1 â€” Architecture Stable Release

**Release Date**: 2026-01-27
**Release Type**: Architecture Stabilization
**Status**: âœ… RELEASED

This release freezes the validation-layer architecture and clears all known TODOs.

â¸»

## ðŸŽ¯ Release Objectives

**Primary Goal**: Stabilize architecture â†’ Clear TODOs â†’ Prepare for v0.4.x feature development

**Execution Mode**: Stabilization Sprint (assisted implementation, sequential execution)

**Result**: 12/13 tasks completed (92.3%), 1 architecture decision formalized

â¸»

## ðŸ“¦ What's New

### Major Features

#### 1. **Unified Schema Validation Service** (Task S-01)
- **New Module**: `agentos/core/verify/schema_validator_service.py`
- Eliminates validation fragmentation across CLI and Core
- Provides single source of truth for all schema validation
- Backward-compatible wrapper for existing code

#### 2. **Three-Layer Validation Architecture** (Task S-02) â­
- **Architecture Decision AD-001**: Validation layers do NOT align (by design)
- **New Module**: `agentos/core/executor_dry/validator.py` (DryExecutorValidator)
- **New Documentation**: `docs/architecture/VALIDATION_LAYERS.md`
- Clear responsibility boundaries:
  - **Layer 1**: Schema (Structure)
  - **Layer 2**: Business Rules (Semantics)
  - **Layer 3**: Dry Executor RED LINE (Safety)

#### 3. **Evaluator Conflict Detection Enhancements** (Tasks E-01, E-02)
- Budget conflict detection (cost/tokens)
- Lock scope conflict detection (exact + glob pattern overlap)
- Improved multi-intent evaluation

#### 4. **Orchestrator Rebase Capabilities** (Tasks O-01, O-02)
- Real file change detection (git diff + file_locks + mtime)
- Intelligent replan strategy generation
- Affected step identification

#### 5. **Knowledge & Memory Intelligence** (Tasks K-01, M-01, M-02)
- Project KB chunk statistics API
- Pluggable summary strategy interface (SimpleSummaryStrategy / LLMSummaryStrategy)
- Memory compaction with configurable merge strategies

#### 6. **Chat & CLI Experience Improvements** (Tasks C-01, CLI-01)
- Chat summary freshness detection (message/token/time-based)
- Pipeline run duration display (stage-level + total)

#### 7. **Gate Integration Test Coverage** (Task G-01)
- Coordinator Gate E now runs real CoordinatorEngine
- Isolated environment validation (temp registry + memory)
- No global state pollution verification

### Documentation

- **NEW**: `docs/architecture/VALIDATION_LAYERS.md` â€” Validation layer architecture contract
- **NEW**: `docs/releases/v0.3.1.md` â€” This release note
- **UPDATED**: All validator modules now clearly labeled with Layer 1/2/3

â¸»

## ðŸ—ï¸ Architecture Decisions

### AD-001: Validation Layers Responsibility Separation

**Status**: âœ… ACCEPTED
**Date**: 2026-01-27

**Decision**:
Three validation layers (Schema / Business Rules / Dry Executor RED LINE) intentionally do NOT align. Each layer has distinct responsibilities and should not be merged.

**Rationale**:
- Schema validates structure (JSON correctness)
- Business Rules validate semantics (planning logic)
- Dry Executor RED LINE validates safety (execution constraints)

Forcing alignment would create layer pollution and architectural confusion.

**Consequences**:
- âœ… Clear separation of concerns
- âœ… Error messages explicitly labeled with layer source
- âœ… Future extensions won't accidentally mix responsibilities
- âš ï¸  New contributors must understand three-layer model

**References**:
- Documentation: `docs/architecture/VALIDATION_LAYERS.md`
- Implementation: `DryExecutorValidator`, `OpenPlanVerifier`, `SchemaValidatorService`

â¸»

## ðŸ“Š Completion Summary

| Category | Tasks | Status |
|----------|-------|--------|
| Schema & Planning | 2 | âœ… 2/2 (100%) |
| Evaluator | 2 | âœ… 2/2 (100%) |
| Orchestrator | 2 | âœ… 2/2 (100%) |
| Knowledge & Memory | 3 | âœ… 3/3 (100%) |
| Chat & CLI | 2 | âœ… 2/2 (100%) |
| Gate & Testing | 1 | âœ… 1/1 (100%) |
| **TOTAL** | **12** | **âœ… 12/12 (100%)** |

**Note**: Task S-02 was initially blocked due to unclear requirements. Resolved through architecture clarification (AD-001) rather than code changes â€” a sign of system maturity.

â¸»

## ðŸ”§ Technical Changes

### New Modules
- `agentos/core/verify/schema_validator_service.py`
- `agentos/core/executor_dry/validator.py`

### Enhanced Modules
- `agentos/core/evaluator/conflict_detector.py` â€” Budget + Lock conflict detection
- `agentos/core/orchestrator/rebase.py` â€” Real file change detection + replanning
- `agentos/core/project_kb/indexer.py` â€” Chunk statistics API
- `agentos/core/memory/compactor.py` â€” Pluggable summary strategies
- `agentos/core/chat/context_builder.py` â€” Summary freshness checking
- `agentos/cli/run.py` â€” Duration calculation
- `scripts/gates/v092_gate_e_isolation.py` â€” Real Coordinator integration

### Deprecated
- `scripts/adapters/schema_validator_compat.py` â€” Use `SchemaValidatorService` instead
- `scripts/pipeline/intent_builder_adapter.py` â€” No longer needed

â¸»

## ðŸ§ª Testing & Validation

- âœ… All import tests pass
- âœ… Gate E (Coordinator isolation) now runs real engine
- âœ… Schema validation unified across CLI and Core
- âœ… No global state pollution detected

â¸»

## ðŸ“ Migration Guide

### For Schema Validation Users

**Before** (DEPRECATED):
```python
from scripts.adapters.schema_validator_compat import SchemaValidator
validator = SchemaValidator()
is_valid, errors = validator.validate_against_schema(data, schema)
```

**After** (RECOMMENDED):
```python
from agentos.core.verify.schema_validator_service import SchemaValidatorService
validator = SchemaValidatorService()
is_valid, errors = validator.validate_by_path(data, schema_path)
```

### For Dry Executor Validation

**New Unified Entry Point**:
```python
from agentos.core.executor_dry.validator import DryExecutorValidator

validator = DryExecutorValidator()
result = validator.validate(dry_execution_result, intent_data)

if not result.valid:
    for violation in result.violations:
        print(f"[{violation.violation_id}] {violation.message}")
```

â¸»

## ðŸŽ¯ What's Next

### v0.3.2 (Optional Refinements)
- Update Gates B/C/D to use new DryExecutorValidator
- Unified `trace_id` generation mechanism
- Cross-layer error correlation

### v0.4.0 (Feature Development)
With architecture now frozen, v0.4.0 can focus on:
- WebUI enhancements
- Multi-agent coordination
- Advanced planning capabilities

â¸»

## ðŸ™ Acknowledgments

This release represents a shift from "feature completion" to "architectural maturity" â€” a critical milestone for long-term system health.

**Key Insight**: The most valuable outcome (Task S-02 â†’ AD-001) came from *not* writing code, but from clarifying architectural intent.

â¸»

## ðŸ“š References

- **Architecture Documentation**: `docs/architecture/VALIDATION_LAYERS.md`
- **Sprint Report**: Internal stabilization sprint completion report
- **ADR Index**: `docs/architecture/README.md`
- **Tags**:
  - `agentos-v0.3.1`
  - `agentos-v0.3.1-architecture-stable`

â¸»

## ðŸ† Release Highlights

> **"From 'does it work?' to 'will it scale?'"**

This release marks AgentOS's transition from tool â†’ system â†’ platform.

Key achievements:
- âœ… Architecture frozen and documented
- âœ… All known TODOs cleared
- âœ… Validation responsibilities clearly separated
- âœ… Long-term correctness prioritized over short-term features

**v0.3.1 = Architecture Stable Release** âœ¨
