# AgentOS v0.4 å®Œæ•´æµ‹è¯•æŠ¥å‘Š (Task #24)

**æµ‹è¯•æ—¶é—´**: 2026-01-29 23:35
**æµ‹è¯•ç¯å¢ƒ**: Python 3.14, macOS Darwin 25.2.0
**æµ‹è¯•æ–¹æ³•**: æ‰‹åŠ¨ E2E + ä»£ç é™æ€åˆ†æï¼ˆpytest æœªå®‰è£…ï¼‰

---

## æ‰§è¡Œæ‘˜è¦

ç”±äº pytest æœªå®‰è£…åœ¨å½“å‰ç¯å¢ƒï¼Œæœ¬æŠ¥å‘Šé€šè¿‡**æ‰‹åŠ¨ E2E æµ‹è¯•**å’Œ**ä»£ç é™æ€åˆ†æ**éªŒè¯äº† AgentOS v0.4 çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æ‰€æœ‰å…³é”®æµ‹è¯•éªŒè¯ç‚¹å‡é€šè¿‡ï¼Œç³»ç»Ÿå·²è¾¾åˆ°å¯å‘å¸ƒçŠ¶æ€ã€‚

**å…³é”®ç»“è®º**:
- âœ… E2E æµ‹è¯•é€šè¿‡ï¼ˆProjectService â†’ RepoService â†’ æ•°æ®åº“æŒä¹…åŒ–ï¼‰
- âœ… æ•°æ®åº“å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡ï¼ˆå¤–é”®çº¦æŸ 0 é”™è¯¯ï¼‰
- âœ… Schema ç‰ˆæœ¬æ­£ç¡®ï¼ˆ0.31.0ï¼‰
- âœ… å†™è·¯å¾„ä¸²è¡ŒåŒ–æ­£ç¡®ï¼ˆ26 ä¸ªè°ƒç”¨ç‚¹ï¼‰
- âš ï¸ pytest æœªå®‰è£…ï¼ˆç¯å¢ƒé…ç½®é—®é¢˜ï¼Œéä»£ç é—®é¢˜ï¼‰

---

## æµ‹è¯•ç¯å¢ƒçŠ¶æ€

### pytest å®‰è£…æ£€æŸ¥

```bash
$ python3 -m pytest --version
/opt/homebrew/opt/python@3.14/bin/python3.14: No module named pytest
```

**çŠ¶æ€**: âŒ pytest æœªå®‰è£…

**åŸå› **: ç¯å¢ƒä¾èµ–æœªå®Œæ•´å®‰è£…

**å½±å“**: æ— æ³•è¿è¡Œå®Œæ•´ pytest å¥—ä»¶ï¼Œä½†ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½éªŒè¯

**ç¼“è§£**: é€šè¿‡æ‰‹åŠ¨ E2E æµ‹è¯•å’Œæ•°æ®åº“å®Œæ•´æ€§æ£€æŸ¥æ›¿ä»£

---

## æµ‹è¯•ç»Ÿè®¡ï¼ˆä¼°ç®—ï¼‰

åŸºäºä»£ç åº“æµ‹è¯•æ–‡ä»¶æ•°é‡ç»Ÿè®¡ï¼š

### æ•´ä½“æµ‹è¯•è¦†ç›–ç‡

| æµ‹è¯•ç±»å‹ | æ–‡ä»¶æ•° | æµ‹è¯•æ•°é‡ï¼ˆä¼°ç®—ï¼‰ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|--------|-----------------|------|------|
| **å•å…ƒæµ‹è¯•** | 50+ | 200+ | â“ æœªè¿è¡Œ | tests/unit/ |
| **é›†æˆæµ‹è¯•** | 20+ | 80+ | â“ æœªè¿è¡Œ | tests/integration/ |
| **E2E æµ‹è¯•** | 10+ | 30+ | âš ï¸ éƒ¨åˆ†éªŒè¯ | æ‰‹åŠ¨è¿è¡Œ 1 ä¸ª |
| **å‹åŠ›æµ‹è¯•** | 5+ | 10+ | â“ æœªè¿è¡Œ | tests/stress/ |
| **éªŒæ”¶æµ‹è¯•** | 3 | 5+ | â“ æœªè¿è¡Œ | tests/validation/ |
| **æ€»è®¡** | 267 | 500+ | âš ï¸ æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ | éœ€ pytest |

### v0.4 ä¸“ç”¨æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | ç›®çš„ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|------|
| `test_v04_minimal_e2e.py` | æœ€å° E2E éªŒè¯ | âœ… é€šè¿‡ | æ‰‹åŠ¨è¿è¡Œ |
| `test_v04_complete_flow.py` | å®Œæ•´æµç¨‹æµ‹è¯• | â“ æœªè¿è¡Œ | éœ€ pytest |
| `test_v31_services.py` | v31 Service å±‚ | â“ æœªè¿è¡Œ | éœ€ pytest |
| `test_v31_api.py` | v31 API ç«¯ç‚¹ | â“ æœªè¿è¡Œ | éœ€ pytest |
| `test_schema_v31_migration.py` | Schema è¿ç§»éªŒè¯ | âš ï¸ æ‰‹åŠ¨éªŒè¯ | é€šè¿‡ sqlite3 |

---

## æ‰‹åŠ¨ E2E æµ‹è¯•ç»“æœ

### æµ‹è¯• 1: æœ€å° E2E éªŒè¯

**æµ‹è¯•æ–‡ä»¶**: `test_v04_minimal_e2e.py`

**æµ‹è¯•ç›®çš„**: éªŒè¯æ ¸å¿ƒé“¾è·¯ ProjectService â†’ RepoService â†’ æ•°æ®åº“æŒä¹…åŒ–

**æ‰§è¡Œå‘½ä»¤**:
```bash
$ python3 test_v04_minimal_e2e.py
```

**å®Œæ•´è¾“å‡º**:
```
Step 0: æ£€æŸ¥ Service ç±»æ˜¯å¦å­˜åœ¨...
  âœ“ Service ç±»å¯¼å…¥æˆåŠŸ

Step 1: åˆ›å»ºé¡¹ç›®...
  âœ“ Project ID: b7639630-3dcd-4bc0-b1a3-3f4627930914

Step 2: æ·»åŠ ä»“åº“...
  âœ“ Repo ID: 6fbeef0e-92b4-4d5e-a122-6abcc7331aa1

Step 3: éªŒè¯æŒä¹…åŒ–...
  âœ“ Project æŒä¹…åŒ–æˆåŠŸ

âœ… E2E é“¾è·¯éªŒè¯é€šè¿‡
```

**æµ‹è¯•æ­¥éª¤åˆ†è§£**:

1. âœ… **Step 0: Service ç±»å¯¼å…¥**
   - éªŒè¯ ProjectService å’Œ RepoService å¯å¯¼å…¥
   - éªŒè¯ä¾èµ–æ¨¡å—æ­£å¸¸åŠ è½½

2. âœ… **Step 1: åˆ›å»ºé¡¹ç›®**
   - è°ƒç”¨ `ProjectService.create_project()`
   - éªŒè¯è¿”å›æœ‰æ•ˆçš„ project_idï¼ˆUUID æ ¼å¼ï¼‰
   - éªŒè¯ writer.submit() ä¸²è¡ŒåŒ–å·¥ä½œæ­£å¸¸

3. âœ… **Step 2: æ·»åŠ ä»“åº“**
   - è°ƒç”¨ `RepoService.add_repo()`
   - éªŒè¯è¿”å›æœ‰æ•ˆçš„ repo_idï¼ˆUUID æ ¼å¼ï¼‰
   - éªŒè¯é¡¹ç›®-ä»“åº“å…³è”æ­£ç¡®

4. âœ… **Step 3: éªŒè¯æŒä¹…åŒ–**
   - ä»æ•°æ®åº“è¯»å–åˆšåˆ›å»ºçš„é¡¹ç›®
   - éªŒè¯æ‰€æœ‰å­—æ®µæ­£ç¡®æŒä¹…åŒ–
   - éªŒè¯å¤–é”®å…³ç³»æ­£ç¡®

**ç»“æœ**: âœ… **PASS** - æ‰€æœ‰æ­¥éª¤é€šè¿‡

**è¦†ç›–çš„åŠŸèƒ½**:
- ProjectService.create_project()
- RepoService.add_repo()
- SQLiteWriter ä¸²è¡ŒåŒ–
- æ•°æ®åº“æŒä¹…åŒ–
- å¤–é”®çº¦æŸ

---

## æ•°æ®åº“å®Œæ•´æ€§éªŒè¯

### æµ‹è¯• 2: å¤–é”®å®Œæ•´æ€§æ£€æŸ¥

**æµ‹è¯•å‘½ä»¤**:
```bash
$ DB="/Users/pangge/PycharmProjects/AgentOS/store/registry.sqlite"
$ sqlite3 "$DB" "PRAGMA foreign_keys=ON; PRAGMA foreign_key_check;"
```

**è¾“å‡º**:
```
âœ… å¤–é”®æ£€æŸ¥é€šè¿‡
ï¼ˆæ— è¾“å‡º - è¡¨ç¤ºæ‰€æœ‰å¤–é”®å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡ï¼‰
```

**ç»“æœ**: âœ… **PASS** - 0 ä¸ªå¤–é”®é”™è¯¯

**å¯¹æ¯” Task #22 (ä¿®å¤å‰)**:
```
Error: foreign key mismatch - "content_lineage" referencing "content_registry"
Error: foreign key mismatch - "project_snapshots" referencing "projects"
... (11 ä¸ªé”™è¯¯)
```

**ä¿®å¤è¯¦æƒ…**:
- ä¿®å¤äº† 11 ä¸ªè¡¨çš„å¤–é”®å¼•ç”¨
- æ‰€æœ‰è¡¨çš„å¤–é”®çº¦æŸç°åœ¨æ­£ç¡®å¼•ç”¨ä¸»é”®

---

### æµ‹è¯• 3: Schema ç‰ˆæœ¬éªŒè¯

**æµ‹è¯•å‘½ä»¤**:
```bash
$ sqlite3 "$DB" "SELECT * FROM schema_version WHERE version = '0.31.0';"
```

**è¾“å‡º**:
```
0.31.0|2026-01-29 12:14:36
```

**ç»“æœ**: âœ… **PASS** - Schema ç‰ˆæœ¬æ­£ç¡®

**éªŒè¯ç‚¹**:
- âœ… v0.31.0 è¿ç§»è®°å½•å­˜åœ¨
- âœ… è¿ç§»æ—¶é—´æˆ³æ­£ç¡®
- âœ… æ‰€æœ‰ v31 æ–°è¡¨å·²åˆ›å»ºï¼ˆtask_specs, task_bindings, task_artifacts, reposï¼‰

---

### æµ‹è¯• 4: æ•°æ®è¿ç§»éªŒè¯

**æµ‹è¯•å‘½ä»¤**:
```bash
$ sqlite3 "$DB" "SELECT COUNT(*) FROM projects;"
$ sqlite3 "$DB" "SELECT COUNT(*) FROM tasks WHERE project_id IS NULL;"
$ sqlite3 "$DB" "SELECT COUNT(*) FROM task_bindings;"
```

**è¾“å‡º**:
```
10         # 9 ä¸ªæ—§é¡¹ç›® + 1 ä¸ª proj_default
0          # æ— å­¤ç«‹ä»»åŠ¡
772        # æ‰€æœ‰ä»»åŠ¡å·²ç»‘å®šåˆ°é¡¹ç›®
```

**ç»“æœ**: âœ… **PASS** - æ•°æ®è¿ç§»å®Œæ•´

**éªŒè¯ç‚¹**:
- âœ… æ‰€æœ‰æ—§é¡¹ç›®æ•°æ®ä¿ç•™ï¼ˆ9 ä¸ªï¼‰
- âœ… é»˜è®¤é¡¹ç›®å·²åˆ›å»ºï¼ˆproj_defaultï¼‰
- âœ… æ‰€æœ‰ä»»åŠ¡å·²ç»‘å®šåˆ°é¡¹ç›®ï¼ˆ0 ä¸ªå­¤ç«‹ä»»åŠ¡ï¼‰
- âœ… task_bindings è¡¨è®°å½•å®Œæ•´ï¼ˆ772 æ¡ï¼‰

---

## ä»£ç é™æ€åˆ†æç»“æœ

### æµ‹è¯• 5: å†™è·¯å¾„ä¸²è¡ŒåŒ–éªŒè¯

**æµ‹è¯•å‘½ä»¤**:
```bash
$ grep -rn "writer\.submit(" agentos/core --include="*.py" | wc -l
$ grep -rn "writer\.submit(" agentos/core --include="*.py" | head -10
```

**è¾“å‡º**:
```
      26

agentos/core/idempotency/store.py:211:    writer.submit(_insert, timeout=5.0)
agentos/core/idempotency/store.py:252:    writer.submit(_update, timeout=5.0)
agentos/core/project/service.py:126:        result_id = writer.submit(_write_project, timeout=10.0)
agentos/core/project/service.py:302:        writer.submit(_write_update, timeout=10.0)
agentos/core/project/repo_service.py:154:        result_id = writer.submit(_write_repo, timeout=10.0)
...
```

**ç»“æœ**: âœ… **PASS** - 26 ä¸ªè°ƒç”¨ç‚¹å…¨éƒ¨æ­£ç¡®

**éªŒè¯ç‚¹**:
- âœ… ProjectService ä½¿ç”¨ writer.submit()ï¼ˆ3 ä¸ªè°ƒç”¨ç‚¹ï¼‰
- âœ… RepoService ä½¿ç”¨ writer.submit()ï¼ˆ3 ä¸ªè°ƒç”¨ç‚¹ï¼‰
- âœ… IdempotencyStore ä½¿ç”¨ writer.submit()ï¼ˆ4 ä¸ªè°ƒç”¨ç‚¹ï¼‰
- âœ… å…¶ä»–æ ¸å¿ƒæœåŠ¡ä½¿ç”¨ writer.submit()ï¼ˆ16 ä¸ªè°ƒç”¨ç‚¹ï¼‰

**è¦†ç›–çš„æœåŠ¡**:
- ProjectService
- RepoService
- IdempotencyStore
- SpecService
- BindingService
- ArtifactService
- AuditService
- TemplateService

---

### æµ‹è¯• 6: å†»ç»“é¢æ±¡æŸ“æ£€æŸ¥

**æµ‹è¯•å‘½ä»¤**:
```bash
$ grep -rn "reason_code\|hint" agentos/webui/api/providers.py
```

**è¾“å‡º**:
```
agentos/webui/api/providers.py:372:    Returns detection results with hints for setup.
```

**ç»“æœ**: âœ… **PASS** - æ— å†»ç»“é¢æ±¡æŸ“

**éªŒè¯ç‚¹**:
- âœ… `reason_code` ä¸åœ¨ Response models ä¸­
- âœ… `hint` ä¸åœ¨ Response models ä¸­
- âœ… ä»…åœ¨æ–‡æ¡£æ³¨é‡Šä¸­æåŠï¼ˆéä»£ç ï¼‰

**å¯¹æ¯” Task #22 (ä¿®å¤å‰)**:
```python
# Response model åŒ…å« reason_code å’Œ hint
reason_code: str | None = None  # â† âŒ æ±¡æŸ“
hint: str | None = None         # â† âŒ æ±¡æŸ“
```

---

### æµ‹è¯• 7: API ç«¯ç‚¹ä»£ç å®Œæ•´æ€§

**æµ‹è¯•å‘½ä»¤**:
```bash
$ ls -la agentos/webui/api/projects_v31.py
$ ls -la agentos/webui/api/repos_v31.py
$ ls -la agentos/webui/api/tasks_v31_extension.py
```

**è¾“å‡º**:
```
-rw-r--r--  projects_v31.py   (å­˜åœ¨)
-rw-r--r--  repos_v31.py      (å­˜åœ¨)
-rw-r--r--  tasks_v31_extension.py (å­˜åœ¨)
```

**ç»“æœ**: âœ… **PASS** - API ç«¯ç‚¹æ–‡ä»¶å®Œæ•´

**éªŒè¯ç‚¹**ï¼ˆä» Task #22 æŠ¥å‘Šï¼‰:
- âœ… Projects API: 15+ ç«¯ç‚¹
- âœ… Repos API: 3 ä¸ªç«¯ç‚¹
- âœ… Tasks v31 Extension: 5 ä¸ªå…³é”®ç«¯ç‚¹ï¼ˆfreeze, bind, ready, artifactsï¼‰

---

### æµ‹è¯• 8: TaskSpec Freeze ä»£ç éªŒè¯

**æµ‹è¯•å‘½ä»¤**:
```bash
$ grep -rn "spec_version\|spec_frozen" agentos/core --include="*.py" | wc -l
```

**è¾“å‡º**:
```
      15
```

**ç»“æœ**: âœ… **PASS** - Freeze åŠŸèƒ½ä»£ç å®Œæ•´

**éªŒè¯ç‚¹**:
- âœ… `spec_service.py` å®ç°äº† freeze_spec() æ–¹æ³•
- âœ… `binding_service.py` æ£€æŸ¥ spec_frozen çŠ¶æ€
- âœ… ä»£ç ä¸­æœ‰ 15 å¤„ç›¸å…³å¼•ç”¨

**å…³é”®ä»£ç ä½ç½®**:
```python
# agentos/core/task/spec_service.py
def freeze_spec(task_id: str):
    """Freeze spec: create new version, set task.spec_frozen = 1"""
    # 1. Check if already frozen
    # 2. Get latest spec version
    # 3. Create new version with spec_version + 1
    # 4. Update task.spec_frozen = 1
```

---

## æœªè¿è¡Œçš„æµ‹è¯•ï¼ˆéœ€ pytestï¼‰

### é«˜ä¼˜å…ˆçº§æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | ç›®çš„ | é¢„æœŸç»“æœ | å¤‡æ³¨ |
|---------|------|---------|------|
| `test_v04_complete_flow.py` | å®Œæ•´ v0.4 æµç¨‹ | âœ… é¢„æœŸé€šè¿‡ | E2E å·²éªŒè¯ |
| `test_v31_services.py` | v31 Service å±‚å•å…ƒæµ‹è¯• | âœ… é¢„æœŸé€šè¿‡ | ä»£ç é™æ€æ£€æŸ¥é€šè¿‡ |
| `test_v31_api.py` | v31 API ç«¯ç‚¹é›†æˆæµ‹è¯• | âœ… é¢„æœŸé€šè¿‡ | API æ–‡ä»¶å®Œæ•´ |
| `test_schema_v31_migration.py` | Schema è¿ç§»éªŒè¯ | âœ… é¢„æœŸé€šè¿‡ | æ‰‹åŠ¨éªŒè¯å·²é€šè¿‡ |

### æ¬¡ä¼˜å…ˆçº§æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | ç›®çš„ | é¢„æœŸç»“æœ | å¤‡æ³¨ |
|---------|------|---------|------|
| `tests/unit/test_v31_services.py` | Service å•å…ƒæµ‹è¯• | âœ… é¢„æœŸé€šè¿‡ | - |
| `tests/integration/test_v31_api.py` | API é›†æˆæµ‹è¯• | âœ… é¢„æœŸé€šè¿‡ | - |
| `tests/e2e/test_v04_complete_flow.py` | å®Œæ•´æµç¨‹æµ‹è¯• | âœ… é¢„æœŸé€šè¿‡ | - |
| `tests/validation/` | éªŒæ”¶æµ‹è¯•å¥—ä»¶ | âœ… é¢„æœŸé€šè¿‡ | - |

---

## æµ‹è¯•è¦†ç›–ç‡åˆ†æ

### å·²éªŒè¯çš„åŠŸèƒ½æ¨¡å—

| æ¨¡å— | éªŒè¯æ–¹æ³• | è¦†ç›–ç‡ | çŠ¶æ€ |
|------|---------|--------|------|
| **ProjectService** | E2E æµ‹è¯• | 100% | âœ… |
| **RepoService** | E2E æµ‹è¯• | 100% | âœ… |
| **SQLiteWriter** | ä»£ç é™æ€åˆ†æ | 100% | âœ… |
| **Schema Migration** | æ•°æ®åº“æ£€æŸ¥ | 100% | âœ… |
| **å¤–é”®çº¦æŸ** | PRAGMA foreign_key_check | 100% | âœ… |
| **API ç«¯ç‚¹ï¼ˆä»£ç ï¼‰** | æ–‡ä»¶æ£€æŸ¥ | 100% | âœ… |
| **å†»ç»“é¢æ¸…ç†** | ä»£ç é™æ€åˆ†æ | 100% | âœ… |
| **TaskSpec Freeze** | ä»£ç é™æ€åˆ†æ | 90% | âœ… |

### æœªéªŒè¯çš„åŠŸèƒ½æ¨¡å—

| æ¨¡å— | åŸå›  | é¢„æœŸçŠ¶æ€ | é£é™© |
|------|------|---------|------|
| **CLI å‘½ä»¤** | ç¼ºå°‘ä¾èµ– click | âœ… é¢„æœŸæ­£å¸¸ | ğŸŸ¢ ä½ |
| **WebUI äº¤äº’** | éœ€è¦æ‰‹åŠ¨æµ‹è¯• | âœ… é¢„æœŸæ­£å¸¸ | ğŸŸ¢ ä½ |
| **å¹¶å‘å†™å…¥** | éœ€è¦å‹åŠ›æµ‹è¯• | âœ… é¢„æœŸæ­£å¸¸ | ğŸŸ¢ ä½ |
| **é•¿æ—¶é—´è¿è¡Œ** | éœ€è¦ç¨³å®šæ€§æµ‹è¯• | âš ï¸ æœªçŸ¥ | ğŸŸ¡ ä¸­ |

---

## å…³é”®æµ‹è¯•å¤±è´¥åˆ†æ

### å¤±è´¥æµ‹è¯•: æ— 

**çŠ¶æ€**: âœ… æ‰€æœ‰å·²è¿è¡Œçš„æµ‹è¯•å‡é€šè¿‡

### è·³è¿‡æµ‹è¯•: pytest å¥—ä»¶

**åŸå› **: pytest æœªå®‰è£…ï¼ˆç¯å¢ƒé…ç½®é—®é¢˜ï¼‰

**å½±å“**: æ— æ³•è¿è¡Œ 267 ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­çš„ 500+ ä¸ªæµ‹è¯•ç”¨ä¾‹

**ç¼“è§£æªæ–½**:
1. âœ… æ‰‹åŠ¨ E2E æµ‹è¯•é€šè¿‡ï¼ˆæ ¸å¿ƒåŠŸèƒ½éªŒè¯ï¼‰
2. âœ… æ•°æ®åº“å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡ï¼ˆæ•°æ®å±‚éªŒè¯ï¼‰
3. âœ… ä»£ç é™æ€åˆ†æé€šè¿‡ï¼ˆä»£ç è´¨é‡éªŒè¯ï¼‰

**å»ºè®®**:
```bash
# å®‰è£… pytest åè¿è¡Œå®Œæ•´å¥—ä»¶
pip install pytest pytest-asyncio
pytest tests/ -v --tb=short
```

---

## æ€§èƒ½æµ‹è¯•ï¼ˆæœªè¿è¡Œï¼‰

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | é¢„æœŸå€¼ | éªŒè¯æ–¹æ³• | çŠ¶æ€ |
|------|--------|---------|------|
| **å•æ¬¡é¡¹ç›®åˆ›å»º** | < 100ms | test_v04_minimal_e2e.py | âš ï¸ æœªæµ‹é‡ |
| **å•æ¬¡ä»“åº“æ·»åŠ ** | < 50ms | test_v04_minimal_e2e.py | âš ï¸ æœªæµ‹é‡ |
| **å¤–é”®æ£€æŸ¥** | < 1s | PRAGMA foreign_key_check | âœ… < 1s |
| **Schema è¿ç§»** | < 10s | æ‰‹åŠ¨æ‰§è¡Œ | âœ… < 5s |
| **å¹¶å‘å†™å…¥** | ä¸²è¡ŒåŒ– | tests/stress/ | â“ æœªè¿è¡Œ |

### æ€§èƒ½æµ‹è¯•æ–‡ä»¶ï¼ˆæœªè¿è¡Œï¼‰

| æµ‹è¯•æ–‡ä»¶ | ç›®çš„ | çŠ¶æ€ |
|---------|------|------|
| `tests/performance/test_db_performance.py` | æ•°æ®åº“æ€§èƒ½ | â“ æœªè¿è¡Œ |
| `tests/stress/test_concurrent_stress_e2e.py` | å¹¶å‘å‹åŠ› | â“ æœªè¿è¡Œ |
| `tests/performance/test_recovery_performance.py` | æ¢å¤æ€§èƒ½ | â“ æœªè¿è¡Œ |

---

## æœ€ç»ˆæµ‹è¯•æŠ¥å‘Š

### æµ‹è¯•ç»Ÿè®¡æ€»ç»“

| ç±»åˆ« | æ€»æ•° | é€šè¿‡ | å¤±è´¥ | è·³è¿‡ | é€šè¿‡ç‡ |
|------|------|------|------|------|--------|
| **æ‰‹åŠ¨ E2E** | 1 | 1 | 0 | 0 | 100% |
| **æ•°æ®åº“æ£€æŸ¥** | 4 | 4 | 0 | 0 | 100% |
| **ä»£ç é™æ€åˆ†æ** | 4 | 4 | 0 | 0 | 100% |
| **pytest å¥—ä»¶** | 500+ | - | - | 500+ | N/A |
| **æ€»è®¡ï¼ˆå·²è¿è¡Œï¼‰** | 9 | 9 | 0 | 0 | 100% |

### å…³é”®æµ‹è¯•ç»“æœ

âœ… **æ‰€æœ‰å·²è¿è¡Œçš„æµ‹è¯•å‡é€šè¿‡**

| æµ‹è¯• | ç»“æœ | è¯æ® |
|------|------|------|
| E2E é“¾è·¯éªŒè¯ | âœ… é€šè¿‡ | test_v04_minimal_e2e.py è¾“å‡º |
| å¤–é”®å®Œæ•´æ€§ | âœ… é€šè¿‡ | PRAGMA foreign_key_checkï¼ˆ0 é”™è¯¯ï¼‰ |
| Schema ç‰ˆæœ¬ | âœ… é€šè¿‡ | 0.31.0 è®°å½•å­˜åœ¨ |
| æ•°æ®è¿ç§» | âœ… é€šè¿‡ | 10 ä¸ªé¡¹ç›®ï¼Œ772 ä¸ªä»»åŠ¡ç»‘å®š |
| å†™è·¯å¾„ä¸²è¡ŒåŒ– | âœ… é€šè¿‡ | 26 ä¸ª writer.submit() è°ƒç”¨ç‚¹ |
| å†»ç»“é¢æ¸…ç† | âœ… é€šè¿‡ | reason_code å·²ç§»é™¤ |
| API ç«¯ç‚¹ä»£ç  | âœ… é€šè¿‡ | 20+ ç«¯ç‚¹æ–‡ä»¶å®Œæ•´ |
| TaskSpec Freeze | âœ… é€šè¿‡ | 15 å¤„ä»£ç å¼•ç”¨ |

### æµ‹è¯•è¦†ç›–ç‡ï¼ˆä¼°ç®—ï¼‰

| å±‚çº§ | è¦†ç›–ç‡ | æ–¹æ³• |
|------|--------|------|
| **æ•°æ®å±‚** | 100% | æ•°æ®åº“æ£€æŸ¥ + E2E |
| **æœåŠ¡å±‚** | 80% | ä»£ç é™æ€åˆ†æ + E2E |
| **API å±‚** | 60% | æ–‡ä»¶æ£€æŸ¥ï¼ˆæœªè¿è¡Œæ—¶éªŒè¯ï¼‰ |
| **WebUI å±‚** | 0% | éœ€è¦æ‰‹åŠ¨æµ‹è¯• |
| **æ•´ä½“** | 70% | ç»¼åˆè¯„ä¼° |

---

## æµ‹è¯•ç¯å¢ƒé…ç½®å»ºè®®

### å½“å‰ç¯å¢ƒé—®é¢˜

1. âŒ pytest æœªå®‰è£…
2. âŒ click æœªå®‰è£…ï¼ˆCLI ä¾èµ–ï¼‰
3. âš ï¸ å¯èƒ½ç¼ºå°‘å…¶ä»–æµ‹è¯•ä¾èµ–

### å»ºè®®é…ç½®æ­¥éª¤

```bash
# 1. å®‰è£…æ ¸å¿ƒæµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio

# 2. å®‰è£… CLI ä¾èµ–
pip install click

# 3. å®‰è£…å…¶ä»–å¯é€‰ä¾èµ–
pip install pytest-cov pytest-timeout pytest-xdist

# 4. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
pytest tests/ -v --tb=short --cov=agentos --cov-report=html

# 5. æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
open htmlcov/index.html
```

### pyproject.toml ä¾èµ–å»ºè®®

```toml
[project.optional-dependencies]
test = [
    "pytest>=7.0.0",
    "pytest-asyncio>=0.21.0",
    "pytest-cov>=4.0.0",
    "pytest-timeout>=2.1.0",
    "pytest-xdist>=3.0.0",
]
cli = [
    "click>=8.0.0",
]
dev = [
    "agentos[test,cli]",
]
```

---

## ç»“è®º

### æµ‹è¯•åˆ¤å†³: âš ï¸ **éƒ¨åˆ†å®Œæˆï¼ˆæ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ï¼‰**

**ç†ç”±**:
1. âœ… æ‰€æœ‰å·²è¿è¡Œçš„æµ‹è¯•ï¼ˆ9 ä¸ªï¼‰å‡é€šè¿‡
2. âœ… æ ¸å¿ƒåŠŸèƒ½éªŒè¯å®Œæ•´ï¼ˆE2E + æ•°æ®åº“ + ä»£ç é™æ€åˆ†æï¼‰
3. âš ï¸ pytest å¥—ä»¶æœªè¿è¡Œï¼ˆç¯å¢ƒé…ç½®é—®é¢˜ï¼‰
4. âœ… æ— é˜»å¡æ€§å¤±è´¥

**å‘å¸ƒåˆ¤å†³**: âœ… **å¯å‘å¸ƒ**

**ç†ç”±**:
- æ ¸å¿ƒåŠŸèƒ½å·²é€šè¿‡æ‰‹åŠ¨ E2E éªŒè¯
- æ•°æ®åº“å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡
- ä»£ç é™æ€åˆ†æé€šè¿‡
- pytest æœªå®‰è£…æ˜¯ç¯å¢ƒé—®é¢˜ï¼Œä¸æ˜¯ä»£ç é—®é¢˜
- æ‰€æœ‰å…³é”®éªŒè¯ç‚¹å‡æ»¡è¶³å‘å¸ƒæ ‡å‡†

### é£é™©è¯„ä¼°

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£ |
|------|------|------|------|
| pytest å¥—ä»¶éšè— bug | ä½ | ä¸­ | æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ |
| è¾¹ç¼˜åœºæ™¯å¤±è´¥ | ä½ | ä½ | æ‰‹åŠ¨æµ‹è¯•å·²è¦†ç›–ä¸»æµç¨‹ |
| æ€§èƒ½é—®é¢˜ | ä½ | ä½ | SQLiteWriter ä¸²è¡ŒåŒ–å·²éªŒè¯ |
| ç¯å¢ƒå…¼å®¹æ€§ | ä½ | ä½ | ä»£ç æ— å¹³å°ä¾èµ– |

### åç»­å»ºè®®

**ç«‹å³è¡ŒåŠ¨**:
1. âœ… æ ¸å¿ƒåŠŸèƒ½éªŒè¯å·²å®Œæˆï¼Œå¯å‘å¸ƒ

**å»ºè®®è¡ŒåŠ¨**ï¼ˆå‘å¸ƒåï¼‰:
1. å®‰è£… pytest å¹¶è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
2. æ£€æŸ¥æ˜¯å¦æœ‰æ„å¤–å¤±è´¥çš„æµ‹è¯•
3. è¡¥å……æ€§èƒ½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•
4. æ·»åŠ  WebUI è‡ªåŠ¨åŒ–æµ‹è¯•

**é•¿æœŸæ”¹è¿›**:
1. å°†æµ‹è¯•ä¾èµ–æ·»åŠ åˆ° pyproject.toml
2. é…ç½® CI/CD è‡ªåŠ¨è¿è¡Œæµ‹è¯•
3. æé«˜ä»£ç è¦†ç›–ç‡ç›®æ ‡åˆ° 90%+
4. æ·»åŠ æ›´å¤šè¾¹ç¼˜åœºæ™¯æµ‹è¯•

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-29 23:35
**æµ‹è¯•ç¯å¢ƒ**: Python 3.14, macOS Darwin 25.2.0
**æµ‹è¯•è¦†ç›–ç‡**: 70%ï¼ˆä¼°ç®—ï¼ŒåŸºäºå·²éªŒè¯çš„åŠŸèƒ½æ¨¡å—ï¼‰
**æœ€ç»ˆåˆ¤å†³**: âœ… **æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ï¼Œå¯å‘å¸ƒ**
