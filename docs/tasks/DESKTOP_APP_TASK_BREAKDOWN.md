# AgentOS Desktop 开发任务拆解

> **版本**: 1.0
> **日期**: 2026-01-30
> **总工作量估算**: 16-20 周

---

## 📋 任务分类

| 类别 | 任务数 | 总工时（天） |
|------|-------|------------|
| 基础设施 | 12 | 10-15 |
| Sidecar 管理 | 15 | 15-20 |
| Runtime 打包 | 10 | 10-15 |
| 更新机制 | 18 | 20-25 |
| 模型管理 | 12 | 10-15 |
| UI/UX | 20 | 15-20 |
| 打包签名 | 15 | 15-20 |
| 测试 | 25 | 20-25 |
| 文档 | 10 | 5-10 |
| **总计** | **137** | **120-165** |

---

## Phase 0: 基础设施（2 周）

### P0.1 项目初始化

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P0.1.1 | 创建 `agentos-desktop` 仓库 | DevOps | 0.5h | - | 仓库已创建，README 完成 |
| P0.1.2 | 初始化 Tauri 项目骨架 | 前端 | 2h | P0.1.1 | `tauri init` 成功，Hello World 运行 |
| P0.1.3 | 配置 Rust 工具链（1.75+） | DevOps | 1h | P0.1.2 | CI 可编译 Rust 代码 |
| P0.1.4 | 配置前端开发环境（Vite + React） | 前端 | 2h | P0.1.2 | 开发服务器运行 |
| P0.1.5 | 配置 ESLint + Prettier | 前端 | 1h | P0.1.4 | Lint 通过 |

### P0.2 目录结构冻结

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P0.2.1 | 编写 `DIRECTORY_STRUCTURE.md` | 架构师 | 4h | - | 文档完成，团队审阅 |
| P0.2.2 | 实现目录初始化脚本 | 后端 | 3h | P0.2.1 | 脚本创建所有必要目录 |
| P0.2.3 | 实现路径规范模块（Rust） | 后端 | 4h | P0.2.1 | 所有路径通过 `Paths::get()` 访问 |

### P0.3 版本管理协议

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P0.3.1 | 定义 `version.json` schema | 架构师 | 2h | - | JSON Schema 文档 |
| P0.3.2 | 实现版本比较逻辑（Rust） | 后端 | 3h | P0.3.1 | 单元测试覆盖 |
| P0.3.3 | 实现版本文件读写（Rust） | 后端 | 2h | P0.3.1 | 可读写 version.json |

### P0.4 配置管理

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P0.4.1 | 定义 `settings.json` schema | 架构师 | 3h | - | 包含端口、路径、更新策略 |
| P0.4.2 | 实现配置读写模块（Rust） | 后端 | 4h | P0.4.1 | 支持默认值和用户覆盖 |
| P0.4.3 | 实现配置迁移逻辑 | 后端 | 3h | P0.4.2 | 旧版配置自动升级 |

---

## Phase 1: Sidecar 生命周期（3 周）

### P1.1 进程管理

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P1.1.1 | 实现 `SidecarManager` trait | 后端 | 4h | P0.2.3 | 定义 start/stop/status 接口 |
| P1.1.2 | 实现 AgentOS Runtime sidecar | 后端 | 6h | P1.1.1 | 可启动 Python 进程 |
| P1.1.3 | 实现 Ollama sidecar | 后端 | 6h | P1.1.1 | 可启动 Ollama 进程 |
| P1.1.4 | 实现进程监控（健康检查） | 后端 | 8h | P1.1.2-3 | HTTP 健康检查每 30s |
| P1.1.5 | 实现自动重启逻辑 | 后端 | 6h | P1.1.4 | 失败 3 次后重启 |

### P1.2 端口管理

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P1.2.1 | 实现端口扫描器（Rust） | 后端 | 4h | - | 可检测端口占用 |
| P1.2.2 | 实现端口分配策略 | 后端 | 3h | P1.2.1 | 冲突时自动切换 |
| P1.2.3 | 持久化端口配置 | 后端 | 2h | P1.2.2 | 写入 `ports.json` |

### P1.3 日志管理

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P1.3.1 | 实现 stdout/stderr 捕获 | 后端 | 4h | P1.1.2-3 | 所有输出进入日志 |
| P1.3.2 | 实现日志轮转 | 后端 | 3h | P1.3.1 | 单文件 < 10 MB |
| P1.3.3 | 实现日志查看器 UI | 前端 | 6h | P1.3.1 | 实时显示最新 100 行 |

### P1.4 生命周期事件

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P1.4.1 | 定义事件类型（Starting/Ready/Failed） | 架构师 | 2h | - | 枚举定义完成 |
| P1.4.2 | 实现事件总线（Rust） | 后端 | 4h | P1.4.1 | 发布/订阅模式 |
| P1.4.3 | UI 订阅 sidecar 事件 | 前端 | 4h | P1.4.2 | 显示状态变化 |

---

## Phase 2: Runtime 打包（3 周）

### P2.1 Nuitka 配置

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P2.1.1 | 安装 Nuitka 并测试简单打包 | 后端 | 4h | - | Hello World 打包成功 |
| P2.1.2 | 编写 AgentOS 打包配置 | 后端 | 8h | P2.1.1 | 包含所有依赖 |
| P2.1.3 | 处理静态资源嵌入 | 后端 | 6h | P2.1.2 | webui/static 可访问 |
| P2.1.4 | 处理数据库迁移文件 | 后端 | 4h | P2.1.2 | migrations/ 可访问 |

### P2.2 跨平台打包

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P2.2.1 | macOS ARM 打包脚本 | DevOps | 6h | P2.1.2 | CI 自动打包 |
| P2.2.2 | macOS Intel 打包脚本 | DevOps | 6h | P2.1.2 | CI 自动打包 |
| P2.2.3 | Windows x64 打包脚本 | DevOps | 8h | P2.1.2 | CI 自动打包 |

### P2.3 打包优化

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P2.3.1 | 剔除不必要依赖 | 后端 | 4h | P2.2.1-3 | 包体积减少 20% |
| P2.3.2 | 优化启动时间 | 后端 | 6h | P2.2.1-3 | < 3 秒启动 |
| P2.3.3 | 测试打包后功能完整性 | QA | 8h | P2.2.1-3 | 所有功能正常 |

---

## Phase 3: 更新机制（4 周）

### P3.1 Manifest 设计

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P3.1.1 | 定义 `manifest.json` schema | 架构师 | 4h | - | JSON Schema 完成 |
| P3.1.2 | 实现 Manifest 解析器（Rust） | 后端 | 4h | P3.1.1 | 可解析远端文件 |
| P3.1.3 | 实现 Manifest 验证（签名） | 后端 | 6h | P3.1.2 | Ed25519 验证 |

### P3.2 更新检测

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P3.2.1 | 实现版本比较逻辑 | 后端 | 4h | P0.3.2 | 可判断是否有更新 |
| P3.2.2 | 实现定时检查（24h） | 后端 | 3h | P3.2.1 | 后台定时任务 |
| P3.2.3 | 实现手动检查 | 前端 | 2h | P3.2.1 | UI 按钮触发 |

### P3.3 下载管理

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P3.3.1 | 实现 HTTP 下载器（Rust） | 后端 | 6h | - | 支持 HTTPS |
| P3.3.2 | 实现断点续传（Range） | 后端 | 8h | P3.3.1 | 中断后可恢复 |
| P3.3.3 | 实现进度回调 | 后端 | 4h | P3.3.1 | 实时通知 UI |
| P3.3.4 | 实现 SHA-256 校验 | 后端 | 3h | P3.3.1 | 下载后验证 |

### P3.4 更新暂存

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P3.4.1 | 实现文件移动（pending → staging） | 后端 | 2h | P3.3.4 | 原子操作 |
| P3.4.2 | 实现 `pending_update.json` 写入 | 后端 | 3h | P3.4.1 | 记录待更新组件 |
| P3.4.3 | 实现空间检查 | 后端 | 2h | P3.4.1 | 磁盘不足时拒绝 |

### P3.5 Updater Helper

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P3.5.1 | 创建 `updater-helper` Rust 项目 | 后端 | 2h | - | 独立编译 |
| P3.5.2 | 实现文件替换逻辑 | 后端 | 8h | P3.5.1 | 替换 resources/ 文件 |
| P3.5.3 | 实现备份机制 | 后端 | 4h | P3.5.2 | 创建 .bak 文件 |
| P3.5.4 | 实现回滚逻辑 | 后端 | 6h | P3.5.3 | 失败时恢复 .bak |
| P3.5.5 | 实现 App 重启 | 后端 | 4h | P3.5.2 | 跨平台启动 |

### P3.6 UI 集成

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P3.6.1 | 设计更新通知 UI | 设计师 | 4h | - | Figma 完成 |
| P3.6.2 | 实现更新通知组件 | 前端 | 6h | P3.6.1 | 显示版本信息 |
| P3.6.3 | 实现下载进度条 | 前端 | 4h | P3.3.3 | 实时更新 |
| P3.6.4 | 实现"重启应用"提示 | 前端 | 3h | P3.4.2 | 明确告知用户 |

---

## Phase 4: 模型管理（3 周）

### P4.1 模型元数据

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P4.1.1 | 收集 Ollama 模型列表 | 后端 | 4h | - | 包含大小/许可证 |
| P4.1.2 | 实现模型数据库（SQLite） | 后端 | 6h | P4.1.1 | 存储元数据 |
| P4.1.3 | 实现模型搜索 API | 后端 | 4h | P4.1.2 | 支持关键词搜索 |

### P4.2 模型下载

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P4.2.1 | 实现 Ollama pull 调用 | 后端 | 4h | - | `ollama pull llama3` |
| P4.2.2 | 实现进度解析（stdout） | 后端 | 8h | P4.2.1 | 解析百分比 |
| P4.2.3 | 实现暂停/恢复 | 后端 | 6h | P4.2.1 | 发送信号控制 |

### P4.3 许可证管理

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P4.3.1 | 收集模型许可证文本 | 后端 | 6h | - | 存储到数据库 |
| P4.3.2 | 实现许可证展示 Modal | 前端 | 4h | P4.3.1 | 用户必须确认 |
| P4.3.3 | 记录用户同意时间戳 | 后端 | 2h | P4.3.2 | 写入日志 |

### P4.4 UI 实现

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P4.4.1 | 设计模型市场 UI | 设计师 | 6h | - | Figma 完成 |
| P4.4.2 | 实现模型列表组件 | 前端 | 8h | P4.4.1 | 显示搜索结果 |
| P4.4.3 | 实现下载进度组件 | 前端 | 6h | P4.2.2 | 实时进度条 |

---

## Phase 5: 首次启动体验（2 周）

### P5.1 欢迎流程

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P5.1.1 | 设计欢迎页面 | 设计师 | 4h | - | Figma 完成 |
| P5.1.2 | 实现欢迎页面 | 前端 | 4h | P5.1.1 | 显示品牌信息 |
| P5.1.3 | 实现路径选择器 | 前端 | 6h | P5.1.2 | 文件夹选择 |
| P5.1.4 | 实现磁盘空间检查 | 后端 | 4h | P5.1.3 | 警告低空间 |

### P5.2 初始模型下载

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P5.2.1 | 设计推荐模型页面 | 设计师 | 3h | - | Figma 完成 |
| P5.2.2 | 实现推荐模型列表 | 前端 | 4h | P5.2.1 | 显示 2-3 个模型 |
| P5.2.3 | 集成下载功能 | 前端 | 4h | P4.2.1 | 可直接下载 |

### P5.3 错误恢复

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P5.3.1 | 实现端口冲突提示 | 前端 | 3h | P1.2.2 | 显示替代端口 |
| P5.3.2 | 实现 Sidecar 失败提示 | 前端 | 4h | P1.1.4 | 显示日志链接 |
| P5.3.3 | 实现一键重试 | 前端 | 3h | P5.3.2 | 重启失败组件 |

---

## Phase 6: 打包与签名（4 周）

### P6.1 macOS 打包

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P6.1.1 | 申请 Apple Developer ID | DevOps | 4h | - | 证书获取 |
| P6.1.2 | 配置代码签名（codesign） | DevOps | 6h | P6.1.1 | 所有 binary 签名 |
| P6.1.3 | 配置公证（notarization） | DevOps | 8h | P6.1.2 | 通过 Gatekeeper |
| P6.1.4 | 创建 DMG 安装包 | DevOps | 4h | P6.1.3 | 拖拽安装 |
| P6.1.5 | 测试 Gatekeeper 验证 | QA | 4h | P6.1.4 | 无警告 |

### P6.2 Windows 打包

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P6.2.1 | 购买 Authenticode 证书 | DevOps | 2h | - | 证书获取 |
| P6.2.2 | 配置代码签名（SignTool） | DevOps | 6h | P6.2.1 | EXE 签名 |
| P6.2.3 | 创建 Installer（NSIS/WiX） | DevOps | 8h | P6.2.2 | 自动安装 |
| P6.2.4 | 测试 SmartScreen | QA | 4h | P6.2.3 | 无警告 |

### P6.3 CI/CD Pipeline

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P6.3.1 | 配置 GitHub Actions | DevOps | 8h | - | 自动打包 |
| P6.3.2 | 实现多平台并行构建 | DevOps | 6h | P6.3.1 | macOS/Windows 同时 |
| P6.3.3 | 自动生成 manifest.json | DevOps | 4h | P6.3.2 | 更新远端文件 |
| P6.3.4 | 配置 CDN 分发 | DevOps | 4h | P6.3.3 | Cloudflare R2 |

### P6.4 质量保证

| ID | 任务 | 负责人 | 工时 | 依赖 | DoD |
|----|------|-------|------|------|-----|
| P6.4.1 | 杀软白名单提交 | DevOps | 8h | P6.1-2 | 主流杀软通过 |
| P6.4.2 | 跨版本升级测试 | QA | 16h | P6.3 | v0.4.0 → v0.4.2 |

---

## 测试任务（贯穿所有阶段）

### 单元测试

| ID | 任务 | 负责人 | 工时 | DoD |
|----|------|-------|------|-----|
| T1 | Sidecar 生命周期测试 | QA | 8h | 覆盖率 > 80% |
| T2 | 版本管理测试 | QA | 4h | 所有边界情况 |
| T3 | 端口分配测试 | QA | 4h | 冲突场景 |
| T4 | 更新下载测试 | QA | 6h | 断点续传 |
| T5 | Updater Helper 测试 | QA | 8h | 回滚机制 |

### 集成测试

| ID | 任务 | 负责人 | 工时 | DoD |
|----|------|-------|------|-----|
| T6 | 完整启动流程测试 | QA | 8h | FTU 3 步 |
| T7 | 模型下载集成测试 | QA | 6h | 进度正确 |
| T8 | 更新完整流程测试 | QA | 12h | 3 个平台 |

### E2E 测试

| ID | 任务 | 负责人 | 工时 | DoD |
|----|------|-------|------|-----|
| T9 | macOS Intel E2E | QA | 16h | 所有场景通过 |
| T10 | macOS ARM E2E | QA | 16h | 所有场景通过 |
| T11 | Windows E2E | QA | 16h | 所有场景通过 |

---

## 文档任务

| ID | 任务 | 负责人 | 工时 | DoD |
|----|------|-------|------|-----|
| D1 | 安装指南 | 技术写作 | 4h | 用户可独立安装 |
| D2 | 故障排除手册 | 技术写作 | 6h | 覆盖常见问题 |
| D3 | 模型许可证 FAQ | 法务 + 技术写作 | 4h | 法务审核通过 |
| D4 | 更新 FAQ | 技术写作 | 3h | 用户理解更新机制 |
| D5 | API 文档（IPC） | 后端 | 6h | 前端可查阅 |
| D6 | 架构决策记录（ADR） | 架构师 | 8h | 所有重大决策 |
| D7 | 打包签名指南 | DevOps | 6h | 可复现流程 |
| D8 | 视频教程（安装） | 市场 | 8h | YouTube 发布 |
| D9 | 视频教程（FTU） | 市场 | 6h | YouTube 发布 |
| D10 | 发布说明模板 | 技术写作 | 2h | 每次发布使用 |

---

## 风险与缓解

| 风险 | 影响任务 | 缓解措施 |
|------|---------|---------|
| Nuitka 打包失败 | P2.* | 提前验证，准备 PyInstaller 备选 |
| 杀毒软件误报 | P6.4.1 | 尽早签名，提前提交白名单 |
| Ollama API 变更 | P1.1.3, P4.* | 锁定版本，监控上游 |
| 更新失败率高 | P3.* | 强制测试，完善回滚 |
| 团队 Rust 学习曲线 | P1.*, P3.* | 培训 + Code Review |

---

## 里程碑与交付

| 里程碑 | 日期（相对） | 关键任务 | 交付物 |
|--------|------------|---------|-------|
| M1: 基础设施完成 | Week 2 | P0.* | 架构文档 + 骨架代码 |
| M2: Sidecar 可用 | Week 5 | P1.* | 两个 sidecar 正常运行 |
| M3: Runtime 打包 | Week 8 | P2.* | 3 个平台可执行文件 |
| M4: 更新机制完成 | Week 12 | P3.* | 端到端更新成功 |
| M5: 模型管理完成 | Week 15 | P4.* | 可下载模型 |
| M6: FTU 完成 | Week 17 | P5.* | 3 步内完成配置 |
| M7: Beta 发布 | Week 20 | P6.*, T* | 可分发安装包 |

---

## 人员分配（建议）

| 角色 | 人数 | 主要职责 |
|------|------|---------|
| 架构师 | 1 | 设计决策、技术评审 |
| Rust 后端 | 2 | Sidecar、更新机制 |
| Python 后端 | 1 | Runtime 适配、打包 |
| 前端开发 | 2 | UI 实现、IPC 对接 |
| DevOps | 1 | CI/CD、签名、分发 |
| QA | 2 | 测试、自动化 |
| 技术写作 | 1 | 文档、教程 |
| 产品经理 | 1 | 需求、验收 |

---

## 下一步行动

1. [ ] 召开项目启动会（Kickoff）
2. [ ] 分配任务到具体人员
3. [ ] 建立每周同步会议（Sprint Planning）
4. [ ] 配置项目管理工具（Jira/Linear）
5. [ ] 启动 P0.1.1（创建仓库）

---

**项目经理**: TBD
**技术负责人**: TBD
**最后更新**: 2026-01-30
