# Voice 功能浏览器端测试检查清单

本文档提供 Voice MVP 功能的浏览器端手动测试检查清单。

## 前置条件

- [ ] AgentOS WebUI 已启动
  ```bash
  uvicorn agentos.webui.app:app
  ```
- [ ] 浏览器支持 WebRTC（Chrome/Edge/Firefox/Safari 最新版本）
- [ ] 有可用的麦克风设备
- [ ] 已授予浏览器麦克风权限（或准备授予）

## 测试环境信息

- **浏览器**: _________________ (版本: _______)
- **操作系统**: _________________
- **测试日期**: _________________
- **测试人员**: _________________

## 测试步骤

### 1. 访问 Voice 面板

- [ ] 打开浏览器，访问 http://localhost:8000
- [ ] 左侧导航栏显示 "Voice" 菜单项
- [ ] 点击 "Voice" 进入语音面板
- [ ] 页面加载成功，无错误提示

**如果失败，记录问题**:
```
问题描述:


控制台错误:


```

---

### 2. UI 渲染检查

- [ ] 显示 "Start Recording" 按钮（绿色或主题色）
- [ ] 显示状态指示器（灰色圆点 + "Idle" 文本）
- [ ] 显示 "Transcript" 区域（空白或提示文本）
- [ ] 显示 "Assistant Response" 区域（空白或提示文本）
- [ ] 整体样式符合暗色主题（如果适用）
- [ ] 布局合理，无元素重叠

**如果 UI 异常，记录截图和问题**:
```
问题描述:


截图路径:


```

---

### 3. 开始录音

- [ ] 点击 "Start Recording" 按钮
- [ ] 浏览器弹出麦克风权限请求
- [ ] 点击"允许"授予麦克风权限
- [ ] 按钮文本变为 "Stop Recording"（或显示停止图标）
- [ ] 状态指示器变为红色圆点 + "Recording" 文本
- [ ] 状态指示器有脉冲动画效果（可选，但推荐）
- [ ] 浏览器地址栏显示麦克风使用图标
- [ ] 控制台无错误日志

**如果权限被拒绝**:
- [ ] 页面显示友好的错误提示（例如："无法访问麦克风，请检查浏览器权限"）
- [ ] 按钮恢复为 "Start Recording"

**如果失败，记录问题**:
```
问题描述:


控制台错误:


Network 面板截图:


```

---

### 4. 录音过程

**测试说明**: 对着麦克风清晰说话，建议说 5-10 秒的完整句子（英文或中文均可）。

- [ ] 对着麦克风说话（例如："Hello, this is a test of the voice system."）
- [ ] Transcript 区域显示部分结果（灰色斜体文本，例如 "[Partial...]"）
- [ ] 部分结果持续更新（如果支持实时 STT）
- [ ] 说话结束后，出现最终结果（白色正常字体）
- [ ] 最终结果文本合理（MVP 可能显示 "[Mock transcription of X.Xs audio]"）

**测试不同音量**:
- [ ] 正常音量说话 → 正常识别
- [ ] 低音量说话 → 仍能识别（或提示音量过低）
- [ ] 大声说话 → 正常识别（无爆音）

**如果 Transcript 未显示，记录问题**:
```
问题描述:


控制台错误:


WebSocket 消息截图 (DevTools > Network > WS):


```

---

### 5. Assistant 回复

- [ ] Transcript 显示最终结果后，Assistant Response 区域显示回复
- [ ] Assistant 回复显示在蓝色（或主题色）气泡中
- [ ] 回复内容正确（MVP 应显示 "[MVP Echo] You said: <transcription>"）
- [ ] 回复文本格式正确（无乱码、无 HTML 标签泄露）
- [ ] 回复时间戳显示正确（可选）

**如果 Assistant 回复未显示，记录问题**:
```
问题描述:


控制台错误:


WebSocket 消息截图:


```

---

### 6. 停止录音

- [ ] 点击 "Stop Recording" 按钮
- [ ] 按钮文本变回 "Start Recording"
- [ ] 状态指示器变回灰色圆点 + "Idle" 文本
- [ ] WebSocket 连接关闭（DevTools > Network > WS 显示连接已关闭）
- [ ] 浏览器地址栏麦克风图标消失
- [ ] 控制台无错误日志

**如果停止失败，记录问题**:
```
问题描述:


控制台错误:


```

---

### 7. 多次会话测试

**测试说明**: 连续进行 3 次录音会话。

#### 会话 1
- [ ] 点击 "Start Recording"
- [ ] 说话：__________________
- [ ] 查看 Transcript 和 Assistant 回复
- [ ] 点击 "Stop Recording"

#### 会话 2
- [ ] 点击 "Start Recording"
- [ ] 说话：__________________
- [ ] 查看 Transcript 和 Assistant 回复
- [ ] 点击 "Stop Recording"

#### 会话 3
- [ ] 点击 "Start Recording"
- [ ] 说话：__________________
- [ ] 查看 Transcript 和 Assistant 回复
- [ ] 点击 "Stop Recording"

**检查**:
- [ ] 每次会话都正常工作
- [ ] 之前的 Transcript 被清空或保留（按设计决定）
- [ ] 无内存泄漏迹象（浏览器任务管理器显示内存稳定）

**如果多次会话失败，记录问题**:
```
问题描述:


失败的会话次数:


```

---

### 8. 错误处理测试

#### 测试 8.1: 拒绝麦克风权限
- [ ] 刷新页面
- [ ] 点击 "Start Recording"
- [ ] 在权限请求中点击"拒绝"或"阻止"
- [ ] 页面显示友好的错误提示
- [ ] 按钮恢复为 "Start Recording"

#### 测试 8.2: 后端服务停止
- [ ] 开始录音
- [ ] 停止后端服务（在终端按 Ctrl+C）
- [ ] 继续说话
- [ ] 页面显示连接断开提示（或 WebSocket 错误）

#### 测试 8.3: 网络异常
- [ ] 开始录音
- [ ] 打开浏览器 DevTools > Network，启用 "Offline" 模式
- [ ] 继续说话
- [ ] 页面显示网络错误提示

**错误处理检查**:
- [ ] 所有错误都有友好的提示信息
- [ ] 错误提示包含建议操作（例如："请刷新页面重试"）
- [ ] 错误后可以恢复正常使用（重启服务、禁用 Offline 后重试）

**如果错误处理不当，记录问题**:
```
问题描述:


期望行为:


实际行为:


```

---

### 9. 性能检查

**测试说明**: 进行 5 分钟连续录音会话。

- [ ] 打开浏览器任务管理器（Chrome: Shift+Esc，其他浏览器类似）
- [ ] 开始录音
- [ ] 持续说话 5 分钟
- [ ] 停止录音

**性能指标**:
- [ ] UI 响应流畅，无卡顿
- [ ] CPU 占用合理（< 20%，视设备而定）
- [ ] 内存占用稳定（无明显增长）
- [ ] WebSocket 消息无延迟（< 1 秒）

**记录性能数据**:
```
CPU 占用: _____ %
内存占用: _____ MB
WebSocket 延迟: _____ ms
帧率 (FPS): _____ (如果适用)
```

**如果性能问题，记录详细信息**:
```
问题描述:


CPU/内存截图:


```

---

### 10. 兼容性测试 (可选)

**如果时间允许，在其他浏览器中重复测试**:

| 浏览器 | 版本 | 是否通过 | 备注 |
|--------|------|----------|------|
| Chrome | _____ | [ ] | ____________ |
| Edge   | _____ | [ ] | ____________ |
| Firefox| _____ | [ ] | ____________ |
| Safari | _____ | [ ] | ____________ |

---

## 验收标准

**所有检查项必须通过 ✅**

### 核心功能（必须通过）
- [ ] 可以创建 Voice Session
- [ ] 可以连接 WebSocket
- [ ] 可以录音并发送音频
- [ ] 可以接收 STT 转写结果
- [ ] 可以接收 Assistant 回复
- [ ] 可以停止 Session
- [ ] 可以进行多次会话

### 用户体验（推荐通过）
- [ ] UI 美观，符合设计规范
- [ ] 状态指示清晰（Idle/Recording）
- [ ] 错误提示友好
- [ ] 性能流畅（无卡顿）

### 稳定性（推荐通过）
- [ ] 无内存泄漏
- [ ] 错误可恢复
- [ ] 支持多次会话

---

## 问题汇总

**如有任何失败项，请在此汇总**:

| 测试项 | 问题描述 | 严重程度 | 截图/日志 |
|--------|----------|----------|----------|
| _____  | ________ | ________ | ________ |

---

## 测试结论

- [ ] **全部通过** - Voice MVP 可以投入使用
- [ ] **部分通过** - 需要修复以下问题：__________________
- [ ] **未通过** - 存在严重问题，需要重新测试

**测试签名**:

测试人员: _________________ 日期: _________________

审核人员: _________________ 日期: _________________

---

## 附录: 常见问题排查

### 问题 1: 麦克风权限被拒绝
**解决方法**:
1. Chrome: 地址栏左侧点击锁图标 > 站点设置 > 麦克风 > 允许
2. Firefox: 地址栏左侧点击锁图标 > 权限 > 使用麦克风 > 允许
3. Safari: 设置 > 网站 > 麦克风 > 允许

### 问题 2: WebSocket 连接失败
**检查**:
1. 后端服务是否运行: `curl http://localhost:8000/api/health`
2. 防火墙是否阻止 WebSocket
3. 浏览器控制台是否有 CORS 错误

### 问题 3: STT 转写无结果
**检查**:
1. 音频是否成功发送（DevTools > Network > WS）
2. 后端日志是否有 STT 处理日志
3. MVP 使用 Mock STT，应返回 "[Mock transcription of X.Xs audio]"

### 问题 4: 性能问题（卡顿/高 CPU）
**排查**:
1. 检查音频采样率（推荐 16kHz）
2. 检查 WebSocket 消息大小（推荐每块 < 50KB）
3. 检查浏览器扩展是否干扰
4. 清空浏览器缓存重试

---

**本检查清单基于 Voice MVP 实现，未来功能（实时 STT、VAD、TTS）暂不包含在此清单中。**
