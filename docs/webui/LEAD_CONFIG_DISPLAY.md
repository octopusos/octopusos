# Lead Scan WebUI é…ç½®æ˜¾ç¤ºåŠŸèƒ½

## æ¦‚è¿°

åœ¨ Lead Scan WebUI é¡µé¢æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„é…ç½®ä¿¡æ¯ï¼Œæå‡ç³»ç»Ÿé€æ˜åº¦å’Œå¯è¿½æº¯æ€§ã€‚

## åŠŸèƒ½ç‰¹æ€§

### 1. é…ç½®æ¥æºæ˜¾ç¤º

ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æ˜¾ç¤ºé…ç½®çš„åŠ è½½æ¥æºï¼š

| æ¥æº | å›¾æ ‡ | é¢œè‰² | è¯´æ˜ |
|------|------|------|------|
| **file** | ğŸ“„ description | è“è‰² | ä»é…ç½®æ–‡ä»¶åŠ è½½ï¼ˆé»˜è®¤: `agentos/config/lead_rules.yaml`ï¼‰ |
| **env** | ğŸ’» code | ç»¿è‰² | ä»ç¯å¢ƒå˜é‡ `LEAD_CONFIG` åŠ è½½ |
| **cli** | âš™ï¸ terminal | æ©™è‰² | ä»å‘½ä»¤è¡Œå‚æ•° `--config` åŠ è½½ |
| **default** | â“ settings | ç°è‰² | ä½¿ç”¨ç¡¬ç¼–ç é»˜è®¤å€¼ï¼ˆfallbackï¼‰ |

### 2. é…ç½®å…ƒä¿¡æ¯

æ˜¾ç¤ºä»¥ä¸‹é…ç½®å…ƒä¿¡æ¯ï¼š

- **é…ç½®æ¥æºæè¿°**: è¯¦ç»†è¯´æ˜é…ç½®å¦‚ä½•åŠ è½½
- **é…ç½®æ–‡ä»¶è·¯å¾„**: æ˜¾ç¤ºå®é™…åŠ è½½çš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
- **é…ç½®ç‰ˆæœ¬å·**: æ˜¾ç¤ºé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„ç‰ˆæœ¬ï¼ˆå¦‚ `1.0.0`ï¼‰
- **é…ç½® Hash**: SHA256 å‰ 8 ä½ï¼Œç”¨äºæ£€æµ‹é…ç½®å˜æ›´

### 3. é˜ˆå€¼æ‘˜è¦

ä»¥å¯è§†åŒ–ç½‘æ ¼æ–¹å¼æ˜¾ç¤ºæ‰€æœ‰è§„åˆ™é˜ˆå€¼ï¼š

- **spike_threshold**: ç›¸åŒé”™è¯¯ç æ¿€å¢é˜ˆå€¼
- **pause_count_threshold**: PAUSE æ¬¡æ•°é˜ˆå€¼
- **retry_threshold**: RETRY åå¤±è´¥é˜ˆå€¼
- **decision_lag_threshold_ms**: å†³ç­–å»¶è¿Ÿé˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰
- **redline_ratio_increase_threshold**: REDLINE å æ¯”å¢å¹…é˜ˆå€¼ï¼ˆç™¾åˆ†æ¯”ï¼‰
- **high_risk_allow_threshold**: é«˜å±æ”¾è¡Œé˜ˆå€¼

## å®ç°æ¶æ„

### åç«¯å®ç°

#### 1. LeadScanJob å¢å¼º

**æ–‡ä»¶**: `agentos/jobs/lead_scan.py`

æ–°å¢æ–¹æ³• `_get_config_info()`:

```python
def _get_config_info(self) -> dict:
    """
    æ”¶é›†é…ç½®ä¿¡æ¯ç”¨äº WebUI æ˜¾ç¤º

    Returns:
        {
            "source": "file" | "env" | "cli" | "default",
            "config_path": "/path/to/config.yaml" or None,
            "config_version": "1.0.0",
            "config_hash": "abc123...",
            "thresholds_summary": {...}
        }
    """
```

é…ç½®æ¥æºä¼˜å…ˆçº§åˆ¤æ–­ï¼š
1. ç¯å¢ƒå˜é‡ `LEAD_CONFIG`ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. CLI å‚æ•° `--config`
3. é»˜è®¤è·¯å¾„ `agentos/config/lead_rules.yaml`
4. ç¡¬ç¼–ç é»˜è®¤å€¼ï¼ˆfallbackï¼‰

#### 2. API å“åº”å¢å¼º

**æ–‡ä»¶**: `agentos/webui/api/lead.py`

`ScanResponse` æ¨¡å‹æ–°å¢å­—æ®µï¼š

```python
class ScanResponse(BaseModel):
    # ... ç°æœ‰å­—æ®µ ...
    config_info: Optional[Dict[str, Any]] = None
```

`/api/lead/scan` ç«¯ç‚¹è¿”å› `config_info`ã€‚

### å‰ç«¯å®ç°

#### 1. LeadScanHistoryView å¢å¼º

**æ–‡ä»¶**: `agentos/webui/static/js/views/LeadScanHistoryView.js`

æ–°å¢æ–¹æ³• `renderConfigInfo(configInfo)`:
- æ¸²æŸ“é…ç½®ä¿¡æ¯å¡ç‰‡
- æ˜¾ç¤ºé…ç½®æ¥æºå¾½ç« 
- æ˜¾ç¤ºé…ç½®å…ƒä¿¡æ¯
- æ˜¾ç¤ºé˜ˆå€¼æ‘˜è¦ç½‘æ ¼

#### 2. CSS æ ·å¼

**æ–‡ä»¶**: `agentos/webui/static/css/components.css`

æ–°å¢æ ·å¼ç±»ï¼š
- `.config-info-section` - é…ç½®ä¿¡æ¯å®¹å™¨
- `.config-info-card` - é…ç½®ä¿¡æ¯å¡ç‰‡
- `.config-header` - å¡ç‰‡å¤´éƒ¨ï¼ˆæ¸å˜èƒŒæ™¯ï¼‰
- `.config-source-badge` - æ¥æºå¾½ç« 
- `.thresholds-grid` - é˜ˆå€¼ç½‘æ ¼å¸ƒå±€
- `.threshold-item` - å•ä¸ªé˜ˆå€¼é¡¹

## ä½¿ç”¨æŒ‡å—

### æ‰‹åŠ¨æµ‹è¯•

#### 1. ä½¿ç”¨é»˜è®¤é…ç½®

```bash
python -m agentos.jobs.lead_scan --window 24h --dry-run
```

é¢„æœŸæ˜¾ç¤ºï¼š
- æ¥æº: `file` (è“è‰²å¾½ç« )
- è·¯å¾„: `agentos/config/lead_rules.yaml`
- ç‰ˆæœ¬: `1.0.0`
- Hash: 8ä½å“ˆå¸Œå€¼

#### 2. ä½¿ç”¨ç¯å¢ƒå˜é‡

```bash
export LEAD_CONFIG=/tmp/test_config.yaml
python -m agentos.jobs.lead_scan --window 24h --dry-run
```

é¢„æœŸæ˜¾ç¤ºï¼š
- æ¥æº: `env` (ç»¿è‰²å¾½ç« )
- è·¯å¾„: `/tmp/test_config.yaml`

#### 3. ä½¿ç”¨ CLI å‚æ•°

```bash
python -m agentos.jobs.lead_scan --window 24h --config /tmp/test_config.yaml --dry-run
```

é¢„æœŸæ˜¾ç¤ºï¼š
- æ¥æº: `cli` (æ©™è‰²å¾½ç« )
- è·¯å¾„: `/tmp/test_config.yaml`

#### 4. WebUI éªŒè¯

1. å¯åŠ¨ WebUI: `agentos webui start`
2. è®¿é—® Lead Scan é¡µé¢
3. ç‚¹å‡» "Dry Run (Preview)" æŒ‰é’®
4. ç­‰å¾…æ‰«æå®Œæˆ
5. éªŒè¯é…ç½®ä¿¡æ¯å¡ç‰‡æ˜¯å¦æ˜¾ç¤ºï¼š
   - é…ç½®æ¥æºå¾½ç« é¢œè‰²æ­£ç¡®
   - é…ç½®è·¯å¾„å®Œæ•´æ˜¾ç¤º
   - æ‰€æœ‰ 6 ä¸ªé˜ˆå€¼æ­£ç¡®æ˜¾ç¤º

### è‡ªåŠ¨åŒ–æµ‹è¯•

å¯ä»¥åˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯é…ç½®ä¿¡æ¯è¿”å›ï¼š

```bash
# æµ‹è¯• API å“åº”
curl -X POST "http://localhost:8000/api/lead/scan?window=24h&dry_run=true" \
  -H "Content-Type: application/json" \
  | jq '.config_info'
```

é¢„æœŸè¾“å‡ºï¼š
```json
{
  "source": "file",
  "config_path": "/path/to/agentos/config/lead_rules.yaml",
  "config_version": "1.0.0",
  "config_hash": "abc12345",
  "thresholds_summary": {
    "spike_threshold": 5,
    "pause_count_threshold": 2,
    "retry_threshold": 1,
    "decision_lag_threshold_ms": 5000,
    "redline_ratio_increase_threshold": 0.1,
    "high_risk_allow_threshold": 1
  }
}
```

## UI è®¾è®¡

### é…ç½®ä¿¡æ¯å¡ç‰‡å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš™ï¸ Configuration Information      [ğŸ“„ Config File]  â”‚ <- æ¸å˜èƒŒæ™¯å¤´éƒ¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Source:  Loaded from YAML configuration file       â”‚
â”‚ Path:    agentos/config/lead_rules.yaml            â”‚
â”‚ Version: 1.0.0                                      â”‚
â”‚ Hash:    abc12345 (for change tracking)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ›ï¸ Rule Thresholds                                 â”‚
â”‚                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Spike    â”‚ Pause    â”‚ Retry    â”‚ Decision â”‚     â”‚
â”‚ â”‚ 5        â”‚ 2        â”‚ 1        â”‚ 5000ms   â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚ Redline  â”‚ High Riskâ”‚                            â”‚
â”‚ â”‚ 10%      â”‚ 1        â”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¢œè‰²æ–¹æ¡ˆ

- **å¤´éƒ¨æ¸å˜**: ç´«è‰²ç³» (`#667eea` â†’ `#764ba2`)
- **é˜ˆå€¼ç½‘æ ¼**: æµ…ç´«è‰²èƒŒæ™¯ + hover æ•ˆæœ
- **å¾½ç« **: æ ¹æ®æ¥æºç±»å‹æ˜¾ç¤ºä¸åŒé¢œè‰²
- **æ–‡æœ¬**: ä¸»è¦æ–‡æœ¬ `#212529`ï¼Œè¾…åŠ©æ–‡æœ¬ `#6c757d`

## é…ç½®å˜æ›´è¿½è¸ª

### Hash è®¡ç®—

é…ç½® Hash ä½¿ç”¨ SHA256 ç®—æ³•è®¡ç®—é…ç½®æ–‡ä»¶å†…å®¹ï¼Œå–å‰ 8 ä½ï¼š

```python
import hashlib
with open(config_path, 'rb') as f:
    config_hash = hashlib.sha256(f.read()).hexdigest()[:8]
```

### å˜æ›´æ£€æµ‹åœºæ™¯

1. **æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶**: Hash ä¼šæ”¹å˜
2. **ç¯å¢ƒå˜é‡åˆ‡æ¢**: æ¥æºå’Œè·¯å¾„ä¼šæ”¹å˜
3. **ç‰ˆæœ¬å‡çº§**: version å­—æ®µä¼šæ”¹å˜

ç®¡ç†å‘˜å¯ä»¥é€šè¿‡æ¯”å¯¹ Hash å€¼ç¡®è®¤é…ç½®æ˜¯å¦è¢«ä¿®æ”¹ã€‚

## éªŒæ”¶æ ‡å‡†

- âœ… é…ç½®æ¥æºæ­£ç¡®è¯†åˆ«ï¼ˆ4 ç§æ¥æºï¼‰
- âœ… é…ç½®è·¯å¾„å®Œæ•´æ˜¾ç¤ºï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- âœ… é˜ˆå€¼æ‘˜è¦å®Œæ•´ï¼ˆ6 ä¸ªé˜ˆå€¼ï¼‰
- âœ… UI ç¾è§‚æ˜“è¯»ï¼ˆæ¸å˜å¡ç‰‡ + ç½‘æ ¼å¸ƒå±€ï¼‰
- âœ… é…ç½® Hash å¯è¿½æº¯å˜æ›´
- âœ… åç«¯ä»£ç ä¿®æ”¹å®Œæˆ
- âœ… å‰ç«¯ç»„ä»¶å®ç°å®Œæˆ
- âœ… CSS æ ·å¼å®ç°å®Œæˆ
- âœ… æ–‡æ¡£å®Œæ•´

## æœªæ¥å¢å¼º

1. **é…ç½®å†å²**: å­˜å‚¨æ¯æ¬¡æ‰«æä½¿ç”¨çš„é…ç½®å¿«ç…§
2. **é…ç½®å¯¹æ¯”**: å¯¹æ¯”ä¸åŒæ—¶é—´ç‚¹çš„é…ç½®å˜æ›´
3. **é…ç½®ç¼–è¾‘**: ç›´æ¥åœ¨ WebUI ä¸Šç¼–è¾‘é…ç½®ï¼ˆéœ€è¦æƒé™æ§åˆ¶ï¼‰
4. **é…ç½®éªŒè¯**: éªŒè¯é…ç½®è¯­æ³•å’Œé˜ˆå€¼åˆç†æ€§
5. **é…ç½®æ¨¡æ¿**: æä¾›ä¸åŒåœºæ™¯çš„é…ç½®æ¨¡æ¿ï¼ˆä¿å®ˆ/æ ‡å‡†/æ¿€è¿›ï¼‰

## ç›¸å…³æ–‡ä»¶

### åç«¯
- `agentos/jobs/lead_scan.py` - Lead æ‰«æä½œä¸š
- `agentos/webui/api/lead.py` - Lead API ç«¯ç‚¹
- `agentos/config/loader.py` - é…ç½®åŠ è½½å™¨
- `agentos/config/lead_rules.yaml` - é»˜è®¤é…ç½®æ–‡ä»¶

### å‰ç«¯
- `agentos/webui/static/js/views/LeadScanHistoryView.js` - Lead æ‰«æè§†å›¾
- `agentos/webui/static/css/components.css` - ç»„ä»¶æ ·å¼

### æ–‡æ¡£
- `docs/webui/LEAD_CONFIG_DISPLAY.md` - æœ¬æ–‡æ¡£
- `agentos/config/lead_rules.yaml` - é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼ˆå¸¦æ³¨é‡Šï¼‰

## é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: é…ç½®ä¿¡æ¯ä¸æ˜¾ç¤º

**ç—‡çŠ¶**: æ‰«æå®Œæˆåæ²¡æœ‰æ˜¾ç¤ºé…ç½®ä¿¡æ¯å¡ç‰‡

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯
2. æ£€æŸ¥ API å“åº”ä¸­æ˜¯å¦åŒ…å« `config_info` å­—æ®µ
3. æ£€æŸ¥ CSS æ–‡ä»¶æ˜¯å¦æ­£ç¡®åŠ è½½

**è§£å†³æ–¹æ³•**: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œåˆ·æ–°é¡µé¢

### é—®é¢˜ 2: é…ç½®æ¥æºæ˜¾ç¤ºé”™è¯¯

**ç—‡çŠ¶**: é…ç½®æ¥æºå¾½ç« æ˜¾ç¤ºä¸æ­£ç¡®

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥ç¯å¢ƒå˜é‡ `LEAD_CONFIG` æ˜¯å¦è®¾ç½®
2. æ£€æŸ¥ CLI å‚æ•° `--config` æ˜¯å¦ä¼ é€’
3. æ£€æŸ¥æ—¥å¿—è¾“å‡ºçš„é…ç½®è·¯å¾„

**è§£å†³æ–¹æ³•**: ç¡®è®¤é…ç½®ä¼˜å…ˆçº§é¡ºåºæ­£ç¡®

### é—®é¢˜ 3: Hash å€¼ä¸º None

**ç—‡çŠ¶**: é…ç½® Hash æ˜¾ç¤ºä¸ºç©º

**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥æ–‡ä»¶è¯»å–æƒé™

**è§£å†³æ–¹æ³•**: ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨ä¸”å¯è¯»

## æ€»ç»“

Lead Scan WebUI é…ç½®æ˜¾ç¤ºåŠŸèƒ½æä¾›äº†å®Œæ•´çš„é…ç½®é€æ˜åº¦ï¼Œè®©ç”¨æˆ·å¯ä»¥ï¼š

1. æ¸…æ¥šçŸ¥é“ç³»ç»Ÿä½¿ç”¨çš„é…ç½®æ¥æº
2. éªŒè¯é˜ˆå€¼è®¾ç½®æ˜¯å¦ç¬¦åˆé¢„æœŸ
3. é€šè¿‡ Hash è¿½è¸ªé…ç½®å˜æ›´
4. å¿«é€Ÿæ’æŸ¥é…ç½®ç›¸å…³é—®é¢˜

è¿™ä¸ªåŠŸèƒ½å¯¹äºå¤šç¯å¢ƒéƒ¨ç½²ã€é…ç½®å®¡è®¡ã€é—®é¢˜æ’æŸ¥éƒ½éå¸¸æœ‰ç”¨ã€‚
